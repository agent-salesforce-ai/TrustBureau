<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Live AI Business Report â€” TrustBureau.ai</title>
  
  <!-- PWA Support -->
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#00C09A">
  <meta name="description" content="Live AI-powered business verification and reports">
  
  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            heading: ['Plus Jakarta Sans', 'Inter', 'system-ui', 'sans-serif'],
            sans: ['Inter', 'system-ui', 'sans-serif']
          },
          colors: {
            brand: {
              green: '#00C09A',
              dark:  '#0F172A',
              gray:  '#64748B',
              light: '#F8FAFC',
              border:'#E5E7EB'
            }
          },
          boxShadow: {
            subtle: '0 10px 20px rgba(0,0,0,.06)'
          },
          animation: {
            'float': 'float 6s ease-in-out infinite',
            'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite'
          },
          keyframes: {
            float: {
              '0%, 100%': { transform: 'translateY(0px)' },
              '50%': { transform: 'translateY(-10px)' }
            }
          }
        }
      }
    }
  </script>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Plus+Jakarta+Sans:wght@700;800&display=swap" rel="stylesheet"/>

  <style>
    body { -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; background:#fff; }
    .dark body { background: #0F172A; }
    .card { border:1px solid #E5E7EB; border-radius:.75rem; background:#fff; box-shadow: 0 10px 20px rgba(0,0,0,.04); }
    .dark .card { background: #1E293B; border-color: #334155; }
    .cta { background:#00C09A; color:#fff; font-weight:700; border-radius:.5rem; transition: all .15s ease; }
    .cta:hover { transform: translateY(-1px); box-shadow: 0 10px 20px rgba(0,192,154,.15); }
    .cta:active { transform: translateY(0); }
    .badge { font-size:.72rem; background:#F1F5F9; padding:.15rem .5rem; border-radius:999px; display:inline-block; }
    .dark .badge { background: #334155; color: #E5E7EB; }
    .score-circle { width:120px; height:120px; border-radius:9999px; display:flex; align-items:center; justify-content:center; border:8px solid; font-family:'Plus Jakarta Sans',sans-serif; font-weight:800; font-size:2.3rem; }
    .score-red { border-color:#FECACA; color:#DC2626; background:#FEF2F2 }
    .score-yellow{ border-color:#FDE68A; color:#D97706; background:#FFFBEB }
    .score-green{ border-color:#A7F3D0; color:#059669; background:#ECFDF5 }
    .spin { animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    @keyframes shimmer { 0%{background-position:200% 0} 100%{background-position:-200% 0} }
    .shimmer { background: linear-gradient(100deg,#F3F4F6 40%,#E5E7EB 50%,#F3F4F6 60%); background-size:200% 100%; animation:shimmer 1.1s ease-in-out infinite; border-radius:.5rem; }
    .dark .shimmer { background: linear-gradient(100deg,#334155 40%,#475569 50%,#334155 60%); }
    
    /* Dark mode specific styles */
    .dark { color: #F1F5F9; }
    .dark .text-brand-dark { color: #F1F5F9; }
    .dark .text-brand-gray { color: #94A3B8; }
    .dark .bg-brand-light { background: #1E293B; }
    .dark .border-brand-border { border-color: #334155; }
    .dark header { background: rgba(15, 23, 42, 0.85); }
    
    /* Print styles */
    @media print {
      header, footer, #theme-toggle, .no-print { display: none !important; }
      .card { box-shadow: none; border: 1px solid #ddd; }
      body { background: white; color: black; }
    }
  </style>
</head>

<body class="font-sans text-brand-dark">
  <!-- API Key Setup Modal -->
  <div id="api-key-modal" class="fixed inset-0 bg-black/50 z-50 hidden">
    <div class="flex items-center justify-center min-h-screen p-4">
      <div class="bg-white dark:bg-gray-800 rounded-lg max-w-md w-full p-6">
        <div class="flex items-start gap-3 mb-4">
          <svg class="w-8 h-8 text-brand-green flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"/>
          </svg>
          <div class="flex-1">
            <h3 class="text-lg font-bold">API Key Required</h3>
            <p class="text-sm text-brand-gray mt-1">Enter your Gemini API key to generate reports</p>
          </div>
        </div>
        
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium mb-1">Gemini API Key</label>
            <input 
              id="api-key-input" 
              type="password" 
              class="w-full px-3 py-2 border border-brand-border rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-green dark:bg-gray-700 dark:border-gray-600"
              placeholder="AIzaSy..."
              autocomplete="off">
            <p class="text-xs text-brand-gray mt-1">
              Get your key at 
              <a href="https://makersuite.google.com/app/apikey" target="_blank" class="text-brand-green hover:underline">
                Google AI Studio
              </a>
            </p>
          </div>
          
          <div class="flex items-start gap-2">
            <input type="checkbox" id="remember-key" class="mt-1" checked>
            <label for="remember-key" class="text-sm">
              <span class="font-medium">Remember my key</span>
              <span class="text-brand-gray block">Stored securely in your browser only</span>
            </label>
          </div>
          
          <div class="bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg p-3">
            <div class="flex gap-2">
              <svg class="w-5 h-5 text-amber-600 dark:text-amber-400 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
              </svg>
              <div class="text-xs text-amber-700 dark:text-amber-300">
                <p class="font-semibold">Security Note</p>
                <p>Your API key is stored locally in your browser and never sent to any servers.</p>
                <p class="mt-1">Created by: agent-salesforce-ai â€¢ 2025-11-11</p>
              </div>
            </div>
          </div>
          
          <div class="flex gap-3">
            <button id="save-api-key" class="flex-1 cta px-4 py-2">
              Save & Continue
            </button>
            <button id="cancel-api-key" class="flex-1 px-4 py-2 border border-brand-border rounded hover:bg-brand-light dark:hover:bg-gray-700">
              Cancel
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Header -->
  <header class="sticky top-0 z-40 bg-white/85 border-b border-brand-border backdrop-blur dark:bg-brand-dark/85">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-2">
        <svg width="28" height="28" viewBox="0 0 50 50" fill="none" aria-hidden="true">
          <path d="M25 5L42.5 12.5V27.5C42.5 37.5 25 45 25 45C25 45 7.5 37.5 7.5 27.5V12.5L25 5Z" fill="#00C09A"/>
          <path d="M17.5 25L22.5 30L32.5 20" stroke="white" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span class="font-heading text-lg md:text-xl font-extrabold">TrustBureau.ai</span>
      </div>

      <nav class="flex items-center gap-3">
        <span id="api-status" class="hidden text-xs px-2 py-1 rounded-full bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400">
          ðŸ”‘ API Key Set
        </span>
        <button id="settings-btn" class="text-sm text-brand-gray hover:text-brand-green" title="Settings">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
          </svg>
        </button>
      </nav>
    </div>
  </header>

  <!-- Hero / Search Section -->
  <section class="max-w-4xl mx-auto px-4 pt-10">
    <h1 class="text-3xl md:text-5xl font-heading font-extrabold text-center animate-float">Live AI Business Report</h1>
    <p class="text-center text-brand-gray mt-3">Search by <span class="font-semibold">company name or website</span> â€¢ Real-time data</p>

    <div class="card p-3 md:p-4 mt-6">
      <form id="search-form" class="relative" autocomplete="off">
        <div class="flex flex-col sm:flex-row gap-3">
          <input id="query" 
                 class="flex-1 px-4 py-3 rounded-lg border border-brand-border focus:outline-none focus:ring-2 focus:ring-brand-green dark:bg-brand-dark dark:border-gray-600"
                 placeholder="e.g., Apple Inc., tesla.com, microsoft, salesforce"
                 autofocus>
          <button id="btn-generate" type="submit" class="cta px-5 py-3 text-lg inline-flex items-center justify-center gap-2">
            <svg class="w-5 h-5" viewBox="0 0 20 20" fill="currentColor"><path d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"/></svg>
            Generate
          </button>
        </div>
      </form>
      <p class="text-xs text-brand-gray mt-2">
        Tip: Enter a company name OR website â€¢ Press <kbd class="px-1.5 py-0.5 text-xs bg-gray-100 dark:bg-gray-700 rounded">âŒ˜K</kbd> to focus
      </p>
    </div>

    <div class="flex justify-center gap-2 mt-4">
      <button id="btn-sample" class="text-xs px-3 py-1.5 border border-brand-border rounded hover:bg-brand-light dark:hover:bg-gray-700">
        Load sample report
      </button>
    </div>
  </section>

  <!-- Results Section -->
  <section id="results" class="max-w-6xl mx-auto px-4 pb-16 mt-8 hidden">
    <!-- Loader -->
    <div id="loader" class="card p-6 md:p-8 hidden">
      <div class="flex items-center gap-4">
        <svg class="w-8 h-8 text-brand-green spin" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <circle cx="12" cy="12" r="10" stroke-width="2" opacity=".15"></circle>
          <path d="M22 12a10 10 0 0 1-10 10" stroke-width="2"></path>
        </svg>
        <div class="flex-1">
          <div class="font-medium">Building your reportâ€¦</div>
          <div class="w-full bg-gray-100 rounded-full h-2 mt-2 overflow-hidden dark:bg-gray-700">
            <span id="bar" class="block h-2 bg-brand-green transition-all duration-500" style="width:8%"></span>
          </div>
          <p class="text-xs text-brand-gray mt-2">Fetching real-time data and generating AI analysis...</p>
        </div>
      </div>
    </div>

    <!-- Error -->
    <div id="error" class="card p-5 border-red-200 bg-red-50 text-red-700 dark:bg-red-900/20 dark:text-red-400 dark:border-red-800 hidden"></div>

    <!-- Report Content -->
    <div id="content" class="space-y-8 hidden">
      <div>
        <h2 id="title" class="font-heading text-2xl md:text-3xl font-extrabold"></h2>
        <p class="text-xs text-brand-gray mt-1">Generated by agent-salesforce-ai â€¢ 2025-11-11</p>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- Score Card -->
        <div class="card p-5">
          <h3 class="font-semibold mb-3">AI Risk Score</h3>
          <div class="flex flex-col items-center">
            <div id="score-circle" class="score-circle mb-3">
              <span id="score-digit">â€”</span>
            </div>
            <p id="score-just" class="text-center text-sm text-brand-gray mb-3"></p>
          </div>
        </div>

        <!-- Summary -->
        <div class="md:col-span-2">
          <div class="card p-5">
            <h3 class="font-semibold mb-3">Business Summary</h3>
            <p id="summary" class="text-sm text-brand-dark leading-relaxed dark:text-gray-300"></p>
            
            <div id="profile" class="mt-4 p-4 border border-brand-border rounded bg-brand-light/40 dark:bg-gray-800/50">
              <h4 class="text-sm font-semibold mb-2">Company Profile</h4>
              <div id="profile-details" class="text-sm space-y-1"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Dark mode toggle -->
  <button id="theme-toggle" class="fixed bottom-4 right-4 p-3 rounded-full bg-brand-light dark:bg-gray-700 shadow-lg z-30 hover:scale-110 transition-transform">
    <svg class="w-5 h-5 dark:hidden" fill="currentColor" viewBox="0 0 20 20">
      <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"/>
    </svg>
    <svg class="w-5 h-5 hidden dark:block text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
      <path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1z" clip-rule="evenodd"/>
    </svg>
  </button>

  <footer class="border-t border-brand-border dark:border-gray-700 mt-16">
    <div class="max-w-6xl mx-auto px-4 py-10 text-center text-sm text-brand-gray">
      Â© 2025 TrustBureau.ai â€” Live AI Business Report â€¢ Built by agent-salesforce-ai
    </div>
  </footer>

  <!-- THE COMPLETE APPLICATION SCRIPT -->
  <script>
    // =================== API KEY MANAGEMENT ===================
    const APIKey = {
      STORAGE_KEY: 'trustbureau_api_key',
      
      get() {
        return localStorage.getItem(this.STORAGE_KEY);
      },
      
      set(key) {
        localStorage.setItem(this.STORAGE_KEY, key);
        this.updateStatus();
      },
      
      exists() {
        return !!this.get();
      },
      
      updateStatus() {
        const status = document.getElementById('api-status');
        if (this.exists()) {
          status.classList.remove('hidden');
        } else {
          status.classList.add('hidden');
        }
      },
      
      async prompt() {
        const modal = document.getElementById('api-key-modal');
        modal.classList.remove('hidden');
        
        return new Promise((resolve) => {
          const save = () => {
            const key = document.getElementById('api-key-input').value.trim();
            if (key) {
              this.set(key);
              modal.classList.add('hidden');
              resolve(key);
            }
          };
          
          document.getElementById('save-api-key').onclick = save;
          document.getElementById('cancel-api-key').onclick = () => {
            modal.classList.add('hidden');
            resolve(null);
          };
        });
      }
    };

    // =================== DARK MODE ===================
    document.getElementById('theme-toggle').onclick = () => {
      document.documentElement.classList.toggle('dark');
    };

    // =================== REPORT GENERATION ===================
    async function generateReport(query) {
      // Get or prompt for API key
      let apiKey = APIKey.get();
      if (!apiKey) {
        apiKey = await APIKey.prompt();
        if (!apiKey) return;
      }

      // Show loader
      document.getElementById('results').classList.remove('hidden');
      document.getElementById('loader').classList.remove('hidden');
      document.getElementById('content').classList.add('hidden');
      document.getElementById('error').classList.add('hidden');

      // Animate progress bar
      let progress = 8;
      const bar = document.getElementById('bar');
      const progressInterval = setInterval(() => {
        progress = Math.min(95, progress + 2);
        bar.style.width = progress + '%';
      }, 200);

      try {
        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            contents: [{
              parts: [{
                text: `Generate a comprehensive business report for "${query}" with this exact JSON structure:
{
  "summary": {
    "companyName": "Official company name",
    "summary": "2-3 sentence business overview"
  },
  "riskScore": {
    "score": number between 300-850,
    "justification": "Brief explanation of score"
  },
  "profile": {
    "founded": "Year",
    "headquarters": "City, State/Country",
    "employees": "Number or range",
    "industry": "Primary industry",
    "website": "https://...",
    "revenue": "Annual revenue"
  }
}

For the risk score: 750-850 = Excellent, 650-749 = Good, 550-649 = Fair, 300-549 = Poor
Return ONLY valid JSON, no markdown or explanation.`
              }]
            }],
            generationConfig: {
              temperature: 0.7,
              maxOutputTokens: 2000,
              responseMimeType: "application/json"
            }
          })
        });

        clearInterval(progressInterval);
        bar.style.width = '100%';

        if (!response.ok) {
          throw new Error(`API error: ${response.status}`);
        }

        const data = await response.json();
        const reportText = data.candidates[0].content.parts[0].text;
        const report = JSON.parse(reportText);
        
        displayReport(report);
        
      } catch (error) {
        clearInterval(progressInterval);
        showError(error);
      } finally {
        document.getElementById('loader').classList.add('hidden');
      }
    }

    function displayReport(data) {
      document.getElementById('content').classList.remove('hidden');
      
      // Company name
      document.getElementById('title').textContent = data.summary?.companyName || 'Unknown Company';
      
      // Summary
      document.getElementById('summary').textContent = data.summary?.summary || 'No summary available';
      
      // Risk Score
      const score = data.riskScore?.score || 0;
      document.getElementById('score-digit').textContent = score;
      document.getElementById('score-just').textContent = data.riskScore?.justification || '';
      
      const circle = document.getElementById('score-circle');
      circle.className = 'score-circle mb-3';
      if (score < 550) circle.classList.add('score-red');
      else if (score < 700) circle.classList.add('score-yellow');
      else circle.classList.add('score-green');
      
      // Profile
      if (data.profile) {
        const profileHtml = Object.entries(data.profile).map(([key, value]) => 
          `<div><span class="text-brand-gray">${key.charAt(0).toUpperCase() + key.slice(1)}:</span> ${value}</div>`
        ).join('');
        document.getElementById('profile-details').innerHTML = profileHtml;
      }
    }

    function showError(error) {
      const errorEl = document.getElementById('error');
      errorEl.innerHTML = `
        <div class="font-semibold">Error generating report</div>
        <div class="text-sm mt-1">${error.message}</div>
        <div class="text-xs mt-2">Check your API key in settings</div>
      `;
      errorEl.classList.remove('hidden');
    }

    // =================== SAMPLE REPORT ===================
    document.getElementById('btn-sample').onclick = () => {
      displayReport({
        summary: {
          companyName: "Salesforce, Inc.",
          summary: "Salesforce is the world's leading CRM platform, providing cloud-based solutions that help businesses connect with customers. Founded in 1999, it serves millions of users globally."
        },
        riskScore: {
          score: 820,
          justification: "Established market leader with strong financials and consistent growth"
        },
        profile: {
          founded: "1999",
          headquarters: "San Francisco, CA",
          employees: "73,000+",
          industry: "Cloud Computing / CRM",
          website: "https://salesforce.com",
          revenue: "$31.4 billion (2023)"
        }
      });
      document.getElementById('results').classList.remove('hidden');
    };

    // =================== FORM HANDLER ===================
    document.getElementById('search-form').onsubmit = (e) => {
      e.preventDefault();
      const query = document.getElementById('query').value.trim();
      if (query) generateReport(query);
    };

    // =================== SETTINGS ===================
    document.getElementById('settings-btn').onclick = () => {
      if (confirm('Change API key?')) {
        document.getElementById('api-key-input').value = APIKey.get() || '';
        APIKey.prompt();
      }
    };

    // =================== KEYBOARD SHORTCUTS ===================
    document.addEventListener('keydown', (e) => {
      if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
        e.preventDefault();
        document.getElementById('query').focus();
      }
    });

    // =================== INIT ===================
    APIKey.updateStatus();
  </script>
</body>
</html>
