<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Business Report Tool — TrustBureau.ai</title>
  <meta name="description" content="Generate and view business reports">
  
  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            heading: ['Plus Jakarta Sans', 'Inter', 'system-ui', 'sans-serif'],
            sans: ['Inter', 'system-ui', 'sans-serif']
          },
          colors: {
            brand: {
              green: '#00C09A',
              dark:  '#0F172A',
              gray:  '#64748B',
              light: '#F8FAFC',
              border:'#E5E7EB'
            }
          }
        }
      }
    }
  </script>

  <style>
    body { -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; background:#fff; }
    .dark body { background: #0F172A; }
    .card { border:1px solid #E5E7EB; border-radius:.75rem; background:#fff; box-shadow: 0 10px 20px rgba(0,0,0,.04); }
    .dark .card { background: #1E293B; border-color: #334155; }
    .cta { background:#00C09A; color:#fff; font-weight:700; border-radius:.5rem; transition: all .15s ease; }
    .cta:hover { transform: translateY(-1px); box-shadow: 0 10px 20px rgba(0,192,154,.15); }
    .score-circle { width:120px; height:120px; border-radius:9999px; display:flex; align-items:center; justify-content:center; border:8px solid; font-family:'Plus Jakarta Sans',sans-serif; font-weight:800; font-size:2.3rem; }
    .score-red { border-color:#FECACA; color:#DC2626; background:#FEF2F2 }
    .score-yellow{ border-color:#FDE68A; color:#D97706; background:#FFFBEB }
    .score-green{ border-color:#A7F3D0; color:#059669; background:#ECFDF5 }
    .spin { animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>

<body class="font-sans text-brand-dark">
  <!-- Header -->
  <header class="sticky top-0 z-50 bg-white/85 border-b border-brand-border backdrop-blur">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-2">
        <svg width="28" height="28" viewBox="0 0 50 50" fill="none">
          <path d="M25 5L42.5 12.5V27.5C42.5 37.5 25 45 25 45C25 45 7.5 37.5 7.5 27.5V12.5L25 5Z" fill="#00C09A"/>
          <path d="M17.5 25L22.5 30L32.5 20" stroke="white" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span class="font-heading text-lg md:text-xl font-extrabold">TrustBureau.ai</span>
      </div>
      
      <div class="flex items-center gap-2">
        <span id="api-status" class="hidden text-xs px-2 py-1 rounded-full bg-green-100 text-green-700">API Ready</span>
        <button id="settings-btn" class="p-2 hover:bg-gray-100 rounded">⚙️</button>
      </div>
    </div>
  </header>

  <!-- Settings Modal -->
  <div id="settings-modal" class="fixed inset-0 bg-black/50 z-50 hidden">
    <div class="flex items-center justify-center min-h-screen p-4">
      <div class="bg-white rounded-lg max-w-md w-full p-6">
        <h3 class="text-lg font-bold mb-4">API Configuration</h3>
        
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium mb-1">Gemini API Key</label>
            <input 
              id="api-key-input" 
              type="password" 
              class="w-full px-3 py-2 border rounded-lg"
              placeholder="AIzaSy...">
            <p class="text-xs text-gray-500 mt-1">
              Get key at: <a href="https://makersuite.google.com/app/apikey" target="_blank" class="text-brand-green">Google AI Studio</a>
            </p>
          </div>
          
          <div class="flex gap-3">
            <button id="save-key" class="flex-1 cta px-4 py-2">Save</button>
            <button id="cancel-key" class="flex-1 px-4 py-2 border rounded">Cancel</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Search Section -->
  <section class="max-w-4xl mx-auto px-4 pt-10">
    <h1 class="text-3xl md:text-5xl font-heading font-extrabold text-center">Business Report Generator</h1>
    <p class="text-center text-gray-600 mt-3">Standalone tool by agent-salesforce-ai • 2025-11-11</p>

    <div class="card p-4 mt-6">
      <form id="search-form" class="flex gap-3">
        <input 
          id="query" 
          class="flex-1 px-4 py-3 border rounded-lg"
          placeholder="Enter company name (e.g., Salesforce, Apple, Microsoft)"
          autofocus>
        <button type="submit" class="cta px-6 py-3">Generate Report</button>
      </form>
    </div>

    <div class="text-center mt-4">
      <button id="sample-btn" class="text-sm text-brand-green hover:underline">Load sample report</button>
    </div>
  </section>

  <!-- Results Section -->
  <section id="results" class="max-w-6xl mx-auto px-4 py-8 hidden">
    <!-- Loader -->
    <div id="loader" class="card p-6 hidden">
      <div class="flex items-center gap-4">
        <svg class="w-8 h-8 text-brand-green spin" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <circle cx="12" cy="12" r="10" stroke-width="2" opacity=".15"></circle>
          <path d="M22 12a10 10 0 0 1-10 10" stroke-width="2"></path>
        </svg>
        <div>Generating report...</div>
      </div>
    </div>

    <!-- Report Content -->
    <div id="content" class="hidden space-y-6">
      <h2 id="company-name" class="text-2xl font-bold"></h2>
      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="card p-5">
          <h3 class="font-semibold mb-3">Risk Score</h3>
          <div id="score-circle" class="score-circle mx-auto">
            <span id="score">—</span>
          </div>
        </div>
        
        <div class="md:col-span-2 card p-5">
          <h3 class="font-semibold mb-3">Summary</h3>
          <p id="summary"></p>
        </div>
      </div>
      
      <div id="details" class="card p-5"></div>
    </div>
  </section>

  <script>
    // ============= STANDALONE API KEY MANAGEMENT =============
    const API_KEY = {
      get() {
        return localStorage.getItem('share_gemini_key');
      },
      
      set(key) {
        localStorage.setItem('share_gemini_key', key);
        this.updateStatus();
      },
      
      exists() {
        return !!this.get();
      },
      
      updateStatus() {
        const status = document.getElementById('api-status');
        if (this.exists()) {
          status.classList.remove('hidden');
        } else {
          status.classList.add('hidden');
        }
      }
    };

    // ============= SETTINGS =============
    document.getElementById('settings-btn').onclick = () => {
      const modal = document.getElementById('settings-modal');
      const input = document.getElementById('api-key-input');
      
      // Pre-fill if exists
      if (API_KEY.exists()) {
        input.value = API_KEY.get();
      }
      
      modal.classList.remove('hidden');
    };

    document.getElementById('save-key').onclick = () => {
      const key = document.getElementById('api-key-input').value.trim();
      if (key) {
        API_KEY.set(key);
        document.getElementById('settings-modal').classList.add('hidden');
        alert('API key saved!');
      }
    };

    document.getElementById('cancel-key').onclick = () => {
      document.getElementById('settings-modal').classList.add('hidden');
    };

    // ============= REPORT GENERATION =============
    async function generateReport(query) {
      // Check for API key
      const apiKey = API_KEY.get();
      if (!apiKey) {
        if (confirm('No API key set. Would you like to add one now?')) {
          document.getElementById('settings-btn').click();
        }
        return;
      }

      // Show loader
      document.getElementById('results').classList.remove('hidden');
      document.getElementById('loader').classList.remove('hidden');
      document.getElementById('content').classList.add('hidden');

      try {
        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            contents: [{
              parts: [{
                text: `Generate a business report for "${query}" with this exact JSON structure:
{
  "summary": {
    "companyName": "Official name",
    "summary": "2-3 sentence overview"
  },
  "riskScore": {
    "score": 300-850,
    "justification": "Brief explanation"
  },
  "profile": {
    "founded": "Year",
    "headquarters": "Location",
    "employees": "Number",
    "industry": "Industry",
    "website": "URL"
  }
}
Return ONLY valid JSON.`
              }]
            }],
            generationConfig: {
              temperature: 0.7,
              maxOutputTokens: 2000,
              responseMimeType: "application/json"
            }
          })
        });

        if (!response.ok) throw new Error(`API error: ${response.status}`);
        
        const data = await response.json();
        const report = JSON.parse(data.candidates[0].content.parts[0].text);
        
        displayReport(report);
        
      } catch (error) {
        alert('Error: ' + error.message);
        console.error(error);
      } finally {
        document.getElementById('loader').classList.add('hidden');
      }
    }

    function displayReport(data) {
      document.getElementById('content').classList.remove('hidden');
      
      // Basic info
      document.getElementById('company-name').textContent = data.summary?.companyName || 'Unknown';
      document.getElementById('summary').textContent = data.summary?.summary || '';
      
      // Score
      const score = data.riskScore?.score || 0;
      document.getElementById('score').textContent = score;
      const circle = document.getElementById('score-circle');
      circle.className = 'score-circle mx-auto';
      if (score < 550) circle.classList.add('score-red');
      else if (score < 700) circle.classList.add('score-yellow');
      else circle.classList.add('score-green');
      
      // Details
      const details = document.getElementById('details');
      if (data.profile) {
        details.innerHTML = `
          <h3 class="font-semibold mb-3">Company Profile</h3>
          <div class="grid grid-cols-2 gap-4 text-sm">
            ${Object.entries(data.profile).map(([k,v]) => 
              `<div><span class="text-gray-600">${k}:</span> ${v}</div>`
            ).join('')}
          </div>
        `;
      }
    }

    // ============= SAMPLE REPORT =============
    document.getElementById('sample-btn').onclick = () => {
      displayReport({
        summary: {
          companyName: "Salesforce, Inc.",
          summary: "Leading CRM platform serving millions of users worldwide."
        },
        riskScore: {
          score: 820,
          justification: "Strong market position and financials"
        },
        profile: {
          founded: "1999",
          headquarters: "San Francisco, CA",
          employees: "70,000+",
          industry: "Cloud Software",
          website: "salesforce.com"
        }
      });
      document.getElementById('results').classList.remove('hidden');
    };

    // ============= FORM HANDLER =============
    document.getElementById('search-form').onsubmit = (e) => {
      e.preventDefault();
      const query = document.getElementById('query').value.trim();
      if (query) generateReport(query);
    };

    // ============= INITIALIZATION =============
    API_KEY.updateStatus();
  </script>
</body>
</html>
