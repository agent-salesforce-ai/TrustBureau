<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Shared Report & Search — TrustBureau.ai</title>

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            heading: ['Plus Jakarta Sans', 'system-ui', 'sans-serif'],
            sans: ['Inter', 'system-ui', 'sans-serif'],
          },
          colors: {
            'brand-green': '#00C09A',
            'brand-dark':  '#0F172A',
            'brand-gray':  '#64748B',
            'brand-light': '#F8FAFC',
            'brand-border':'#E5E7EB',
          },
          boxShadow: { card: '0 10px 24px rgba(0,0,0,.06)' }
        }
      }
    }
  </script>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Plus+Jakarta+Sans:wght@700;800&display=swap" rel="stylesheet"/>

  <style>
    html { scroll-behavior: smooth; }
    body { -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; background:white; }
    .dark body { background: #0F172A; color: #F1F5F9; }

    .widget-card{border:1px solid #E5E7EB;border-radius:.75rem;background:#fff;box-shadow:0 10px 20px rgba(0,0,0,.06)}
    .dark .widget-card { background: #1E293B; border-color: #334155; }
    .cta-button { transition: all .25s ease; }
    .cta-button:hover { transform: translateY(-1px); box-shadow:0 12px 20px rgba(0,192,154,.15); }

    .score-circle{width:120px;height:120px;border-radius:9999px;display:flex;align-items:center;justify-content:center;font-family:'Plus Jakarta Sans',sans-serif;font-weight:800;font-size:2.25rem;border:8px solid}
    .score-red{border-color:#FECACA;color:#DC2626;background:#FEF2F2}
    .score-yellow{border-color:#FDE68A;color:#D97706;background:#FFFBEB}
    .score-green{border-color:#A7F3D0;color:#059669;background:#ECFDF5}
    
    .dark .score-red { border-color: #991B1B; background: #7F1D1D; }
    .dark .score-yellow { border-color: #92400E; background: #78350F; }
    .dark .score-green { border-color: #065F46; background: #064E3B; }

    @keyframes spin { to { transform: rotate(360deg); } }
    .spin { animation: spin 1s linear infinite; }
    
    /* Loading states */
    @keyframes shimmer { 0% {background-position: 200% 0} 100% {background-position: -200% 0} }
    .shimmer { background: linear-gradient(100deg,#F3F4F6 40%,#E5E7EB 50%,#F3F4F6 60%); background-size:200% 100%; animation:shimmer 1.1s ease-in-out infinite; border-radius:.5rem; }
    .dark .shimmer { background: linear-gradient(100deg,#334155 40%,#475569 50%,#334155 60%); }
  </style>
</head>

<body class="font-sans">
  <!-- Header -->
  <header class="sticky top-0 z-50 bg-white/90 backdrop-blur border-b border-brand-border dark:bg-brand-dark/90 dark:border-gray-700">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <a href="index.html" class="flex items-center gap-2">
        <svg class="w-7 h-7" viewBox="0 0 50 50" fill="none">
          <path d="M25 5L42.5 12.5V27.5C42.5 37.5 25 45 25 45C25 45 7.5 37.5 7.5 27.5V12.5L25 5Z" fill="#00C09A"/>
          <path d="M17.5 25L22.5 30L32.5 20" stroke="white" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span class="font-heading text-xl font-extrabold text-brand-dark dark:text-white">TrustBureau.ai</span>
      </a>

      <button id="darkModeToggle" class="p-2 rounded-lg hover:bg-brand-light dark:hover:bg-gray-800 transition-colors">
        <svg id="sunIcon" class="w-5 h-5 hidden dark:block" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
        </svg>
        <svg id="moonIcon" class="w-5 h-5 block dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
        </svg>
      </button>
    </div>
  </header>

  <!-- Main Content -->
  <main class="max-w-6xl mx-auto px-4 py-8">
    
    <!-- Search Section -->
    <section class="mb-8">
      <div class="widget-card p-6">
        <h2 class="text-2xl font-heading font-bold mb-4 text-brand-dark dark:text-white">Search for a Company</h2>
        <p class="text-brand-gray dark:text-gray-400 mb-4">Generate a new AI-powered business report</p>
        
        <div class="flex gap-3 mb-4">
          <input 
            type="text" 
            id="companyInput" 
            placeholder="Enter company name (e.g., Apple Inc., Microsoft)" 
            class="flex-1 px-4 py-3 border border-brand-border rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-green dark:bg-gray-800 dark:border-gray-600 dark:text-white"
          />
          <button 
            id="generateBtn"
            class="px-6 py-3 bg-brand-green text-white font-bold rounded-lg cta-button hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            Generate
          </button>
        </div>
        
        <div id="searchError" class="hidden p-4 bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-800 rounded-lg text-red-700 dark:text-red-300 text-sm"></div>
        <div id="searchLoading" class="hidden p-4 bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-800 rounded-lg text-blue-700 dark:text-blue-300 text-sm">
          <div class="flex items-center gap-2">
            <svg class="w-5 h-5 spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
            </svg>
            <span>Generating report... This may take 30-60 seconds.</span>
          </div>
        </div>
      </div>
    </section>

    <!-- New Search Results -->
    <section id="newReportSection" class="hidden mb-8">
      <div class="widget-card p-6">
        <div class="flex items-center justify-between mb-6">
          <div>
            <h2 class="text-2xl font-heading font-bold text-brand-dark dark:text-white">New Search Results</h2>
            <p class="text-xs text-brand-gray dark:text-gray-400 mt-1">Generated report</p>
          </div>
          <div class="flex items-center gap-3">
            <button id="btnPrintNew" class="px-4 py-2 border border-brand-border rounded-lg hover:bg-brand-light dark:hover:bg-gray-700 dark:border-gray-600 text-sm font-medium transition-colors">
              Print / PDF
            </button>
            <button id="btnCopyLinkNew" class="px-4 py-2 bg-brand-green text-white font-bold rounded-lg hover:bg-green-600 transition-colors text-sm">
              Copy Link
            </button>
          </div>
        </div>
        <div id="newReportContent"></div>
      </div>
    </section>

    <!-- Shared Report -->
    <section id="sharedReportSection" class="hidden">
      <div class="widget-card p-6">
        <div class="flex items-center justify-between mb-6">
          <div>
            <h2 class="text-2xl font-heading font-bold text-brand-dark dark:text-white">Shared Report</h2>
            <p class="text-xs text-brand-gray dark:text-gray-400 mt-1" id="sharedReportTimestamp">Shared report snapshot</p>
          </div>
          <div class="flex items-center gap-3">
            <button id="btnPrintShared" class="px-4 py-2 border border-brand-border rounded-lg hover:bg-brand-light dark:hover:bg-gray-700 dark:border-gray-600 text-sm font-medium transition-colors">
              Print / PDF
            </button>
            <button id="btnCopyLinkShared" class="px-4 py-2 bg-brand-green text-white font-bold rounded-lg hover:bg-green-600 transition-colors text-sm">
              Copy Link
            </button>
          </div>
        </div>
        <div id="sharedReportContent"></div>
      </div>
    </section>

    <!-- No Data Message -->
    <div id="noDataMessage" class="hidden text-center py-12">
      <svg class="w-16 h-16 mx-auto mb-4 text-brand-gray" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
      </svg>
      <h3 class="text-xl font-heading font-bold text-brand-dark dark:text-white mb-2">No Report Available</h3>
      <p class="text-brand-gray dark:text-gray-400">Search for a company above to generate a new report.</p>
    </div>

  </main>

  <script>
    // ⚠️ REQUIRED: Get your FREE Gemini API key from https://aistudio.google.com/app/apikey
    // Then replace "YOUR_GEMINI_API_KEY_HERE" below with your actual key
    const zakk = "YOUR_GEMINI_API_KEY_HERE"; // or set window.zakk at runtime

    //===========================================
    // Dark Mode
    //===========================================
    const darkModeToggle = document.getElementById('darkModeToggle');
    const html = document.documentElement;
    
    // Initialize dark mode from localStorage
    if (localStorage.getItem('darkMode') === 'true' || 
        (!localStorage.getItem('darkMode') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
      html.classList.add('dark');
    }
    
    darkModeToggle.addEventListener('click', () => {
      html.classList.toggle('dark');
      localStorage.setItem('darkMode', html.classList.contains('dark'));
    });

    //===========================================
    // State Management
    //===========================================
    let sharedReportData = null;
    let newSearchData = null;

    //===========================================
    // API Integration
    //===========================================
    async function callGeminiAPI(companyName) {
      // Validate API key
      if (!zakk || zakk === 'YOUR_GEMINI_API_KEY_HERE') {
        throw new Error('❌ API Key Required!\n\n' +
          '1. Get a FREE Gemini API key from:\n   https://aistudio.google.com/app/apikey\n\n' +
          '2. Replace "YOUR_GEMINI_API_KEY_HERE" on line 176 with your key\n\n' +
          '3. Or set it via browser console:\n   window.zakk = "your-key-here"');
      }

      const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${zakk}`;
      
      const prompt = `Generate a comprehensive business verification report for: ${companyName}

Return ONLY valid JSON (no markdown, no code blocks) with this exact structure:
{
  "company_name": "Official company name",
  "ai_risk_score": 750,
  "positive_factors": ["factor1", "factor2", "factor3"],
  "negative_factors": ["factor1", "factor2"],
  "business_summary": "2-3 sentence overview",
  "corporate_filings": ["filing1", "filing2"],
  "operational_highlights": ["highlight1", "highlight2"],
  "headlines": ["headline1", "headline2"],
  "contact": {
    "address": "Full address",
    "phone": "Phone number",
    "email": "Email",
    "website": "Website URL",
    "lat": 37.7749,
    "lng": -122.4194
  },
  "company_facts": ["fact1", "fact2", "fact3"],
  "public_records": ["record1", "record2"],
  "leadership": ["Name - Title", "Name - Title"],
  "products_services": ["product1", "product2"],
  "competitors": ["Competitor 1", "Competitor 2"],
  "web_social": {
    "website_status": "Active",
    "social_presence": "Strong",
    "online_reviews": "4.5/5"
  },
  "customer_reviews": [
    {"rating": 5, "text": "Great company", "source": "Google"},
    {"rating": 4, "text": "Good service", "source": "Yelp"}
  ],
  "sources": ["https://example.com/source1", "https://example.com/source2"]
}`;

      const response = await fetch(apiUrl, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          contents: [{
            parts: [{ text: prompt }]
          }],
          generationConfig: {
            temperature: 0.7,
            maxOutputTokens: 8192,
          }
        })
      });

      if (!response.ok) {
        const errorData = await response.json().catch(() => null);
        if (response.status === 400 && errorData?.error?.message?.includes('API key')) {
          throw new Error('API key expired or invalid. Please get a new key from https://aistudio.google.com/app/apikey');
        }
        throw new Error(`API Error: ${response.status} - ${errorData?.error?.message || 'Unknown error'}`);
      }

      const data = await response.json();
      const text = data.candidates?.[0]?.content?.parts?.[0]?.text || '';
      
      // Parse JSON from response
      const jsonMatch = text.match(/\{[\s\S]*\}/);
      if (!jsonMatch) {
        throw new Error('Failed to extract JSON from API response');
      }
      
      const reportData = JSON.parse(jsonMatch[0]);
      reportData.timestamp = new Date().toISOString();
      
      return reportData;
    }

    //===========================================
    // Report Rendering
    //===========================================
    function renderReport(data, containerId) {
      const container = document.getElementById(containerId);
      if (!data || !container) return;

      const scoreClass = data.ai_risk_score >= 700 ? 'score-green' : 
                         data.ai_risk_score >= 500 ? 'score-yellow' : 'score-red';

      container.innerHTML = `
        <!-- Company Header -->
        <div class="mb-8">
          <h1 class="text-3xl font-heading font-extrabold text-brand-dark dark:text-white mb-2">
            ${data.company_name || 'Company Report'}
          </h1>
          ${data.timestamp ? `<p class="text-sm text-brand-gray dark:text-gray-400">Generated: ${new Date(data.timestamp).toLocaleString()}</p>` : ''}
        </div>

        <!-- AI Risk Score -->
        <div class="mb-8 p-6 bg-brand-light dark:bg-gray-800 rounded-lg">
          <div class="flex items-center gap-6">
            <div class="${scoreClass} score-circle">
              ${data.ai_risk_score || 'N/A'}
            </div>
            <div class="flex-1">
              <h3 class="text-xl font-heading font-bold mb-2 text-brand-dark dark:text-white">AI Risk Score</h3>
              ${data.positive_factors?.length ? `
                <div class="mb-2">
                  <span class="text-sm font-semibold text-green-700 dark:text-green-400">Positive Factors:</span>
                  <ul class="text-sm text-brand-gray dark:text-gray-400 ml-4">
                    ${data.positive_factors.map(f => `<li>• ${f}</li>`).join('')}
                  </ul>
                </div>
              ` : ''}
              ${data.negative_factors?.length ? `
                <div>
                  <span class="text-sm font-semibold text-red-700 dark:text-red-400">Negative Factors:</span>
                  <ul class="text-sm text-brand-gray dark:text-gray-400 ml-4">
                    ${data.negative_factors.map(f => `<li>• ${f}</li>`).join('')}
                  </ul>
                </div>
              ` : ''}
            </div>
          </div>
        </div>

        <!-- Business Summary -->
        ${data.business_summary ? `
          <div class="mb-6">
            <h3 class="text-lg font-heading font-bold mb-2 text-brand-dark dark:text-white">Business Summary</h3>
            <p class="text-brand-gray dark:text-gray-400">${data.business_summary}</p>
          </div>
        ` : ''}

        <!-- Corporate Filings -->
        ${data.corporate_filings?.length ? `
          <div class="mb-6">
            <h3 class="text-lg font-heading font-bold mb-2 text-brand-dark dark:text-white">Corporate Filings</h3>
            <ul class="text-brand-gray dark:text-gray-400">
              ${data.corporate_filings.map(f => `<li>• ${f}</li>`).join('')}
            </ul>
          </div>
        ` : ''}

        <!-- Contact & Location -->
        ${data.contact ? `
          <div class="mb-6">
            <h3 class="text-lg font-heading font-bold mb-2 text-brand-dark dark:text-white">Contact & Location</h3>
            <div class="grid md:grid-cols-2 gap-4">
              <div>
                ${data.contact.address ? `<p class="text-sm mb-1 text-brand-gray dark:text-gray-400"><strong>Address:</strong> ${data.contact.address}</p>` : ''}
                ${data.contact.phone ? `<p class="text-sm mb-1 text-brand-gray dark:text-gray-400"><strong>Phone:</strong> ${data.contact.phone}</p>` : ''}
                ${data.contact.email ? `<p class="text-sm mb-1 text-brand-gray dark:text-gray-400"><strong>Email:</strong> ${data.contact.email}</p>` : ''}
                ${data.contact.website ? `<p class="text-sm text-brand-gray dark:text-gray-400"><strong>Website:</strong> <a href="${data.contact.website}" target="_blank" class="text-brand-green hover:underline">${data.contact.website}</a></p>` : ''}
              </div>
              ${data.contact.lat && data.contact.lng ? `
                <div>
                  <iframe 
                    width="100%" 
                    height="200" 
                    frameborder="0" 
                    style="border:0;border-radius:0.5rem;" 
                    src="https://www.google.com/maps?q=${data.contact.lat},${data.contact.lng}&output=embed"
                    allowfullscreen>
                  </iframe>
                </div>
              ` : ''}
            </div>
          </div>
        ` : ''}

        <!-- Company Facts -->
        ${data.company_facts?.length ? `
          <div class="mb-6">
            <h3 class="text-lg font-heading font-bold mb-2 text-brand-dark dark:text-white">Company Facts</h3>
            <ul class="text-brand-gray dark:text-gray-400">
              ${data.company_facts.map(f => `<li>• ${f}</li>`).join('')}
            </ul>
          </div>
        ` : ''}

        <!-- Leadership -->
        ${data.leadership?.length ? `
          <div class="mb-6">
            <h3 class="text-lg font-heading font-bold mb-2 text-brand-dark dark:text-white">Leadership</h3>
            <ul class="text-brand-gray dark:text-gray-400">
              ${data.leadership.map(l => `<li>• ${l}</li>`).join('')}
            </ul>
          </div>
        ` : ''}

        <!-- Products & Services -->
        ${data.products_services?.length ? `
          <div class="mb-6">
            <h3 class="text-lg font-heading font-bold mb-2 text-brand-dark dark:text-white">Products & Services</h3>
            <ul class="text-brand-gray dark:text-gray-400">
              ${data.products_services.map(p => `<li>• ${p}</li>`).join('')}
            </ul>
          </div>
        ` : ''}

        <!-- Competitors -->
        ${data.competitors?.length ? `
          <div class="mb-6">
            <h3 class="text-lg font-heading font-bold mb-2 text-brand-dark dark:text-white">Competitors</h3>
            <ul class="text-brand-gray dark:text-gray-400">
              ${data.competitors.map(c => `<li>• ${c}</li>`).join('')}
            </ul>
          </div>
        ` : ''}

        <!-- Customer Reviews -->
        ${data.customer_reviews?.length ? `
          <div class="mb-6">
            <h3 class="text-lg font-heading font-bold mb-2 text-brand-dark dark:text-white">Customer Reviews</h3>
            ${data.customer_reviews.map(r => `
              <div class="mb-3 p-3 bg-brand-light dark:bg-gray-800 rounded-lg">
                <div class="flex items-center gap-2 mb-1">
                  <span class="text-yellow-500">${'★'.repeat(r.rating)}${'☆'.repeat(5-r.rating)}</span>
                  <span class="text-xs text-brand-gray dark:text-gray-400">${r.source || 'Unknown'}</span>
                </div>
                <p class="text-sm text-brand-gray dark:text-gray-400">${r.text}</p>
              </div>
            `).join('')}
          </div>
        ` : ''}

        <!-- Sources -->
        ${data.sources?.length ? `
          <div class="mb-6">
            <h3 class="text-lg font-heading font-bold mb-2 text-brand-dark dark:text-white">Sources</h3>
            <ul class="text-brand-gray dark:text-gray-400 text-sm">
              ${data.sources.map(s => `<li>• <a href="${s}" target="_blank" class="text-brand-green hover:underline">${s}</a></li>`).join('')}
            </ul>
          </div>
        ` : ''}
      `;
    }

    function showError(message) {
      const searchError = document.getElementById('searchError');
      searchError.textContent = message;
      searchError.classList.remove('hidden');
    }

    //===========================================
    // Initialization
    //===========================================
    document.addEventListener('DOMContentLoaded', () => {
      //===========================================
      // Event Handlers
      //===========================================
      document.getElementById('generateBtn').addEventListener('click', async () => {
        const companyInput = document.getElementById('companyInput');
        const companyName = companyInput.value.trim();
        
        if (!companyName) {
          showError('Please enter a company name');
          return;
        }

        const generateBtn = document.getElementById('generateBtn');
        const searchError = document.getElementById('searchError');
        const searchLoading = document.getElementById('searchLoading');
        
        // Reset UI
        generateBtn.disabled = true;
        searchError.classList.add('hidden');
        searchLoading.classList.remove('hidden');
        
        try {
          // Call API
          newSearchData = await callGeminiAPI(companyName);
          
          // Save to localStorage
          const shareId = 'new_' + Date.now();
          localStorage.setItem(`trustbureau_share_${shareId}`, JSON.stringify(newSearchData));
          localStorage.setItem('trustbureau_last_report', JSON.stringify(newSearchData));
          
          // Render new report
          renderReport(newSearchData, 'newReportContent');
          document.getElementById('newReportSection').classList.remove('hidden');
          document.getElementById('noDataMessage').classList.add('hidden');
          
          // Scroll to results
          document.getElementById('newReportSection').scrollIntoView({ behavior: 'smooth' });
          
        } catch (error) {
          showError(error.message);
        } finally {
          generateBtn.disabled = false;
          searchLoading.classList.add('hidden');
        }
      });

      // Print buttons
      document.getElementById('btnPrintNew')?.addEventListener('click', () => {
        window.print();
      });
      
      document.getElementById('btnPrintShared')?.addEventListener('click', () => {
        window.print();
      });
      
      // Copy Link buttons
      document.getElementById('btnCopyLinkNew')?.addEventListener('click', () => {
        if (!newSearchData) return;
        
        const shareId = 'share_' + Date.now();
        localStorage.setItem(`trustbureau_share_${shareId}`, JSON.stringify(newSearchData));
        
        const shareUrl = `${window.location.origin}${window.location.pathname}?id=${shareId}`;
        
        navigator.clipboard.writeText(shareUrl).then(() => {
          const btn = document.getElementById('btnCopyLinkNew');
          const originalText = btn.textContent;
          btn.textContent = '✓ Link Copied!';
          setTimeout(() => { btn.textContent = originalText; }, 2000);
        });
      });
      
      document.getElementById('btnCopyLinkShared')?.addEventListener('click', () => {
        const currentUrl = window.location.href;
        
        navigator.clipboard.writeText(currentUrl).then(() => {
          const btn = document.getElementById('btnCopyLinkShared');
          const originalText = btn.textContent;
          btn.textContent = '✓ Link Copied!';
          setTimeout(() => { btn.textContent = originalText; }, 2000);
        });
      });
      
      //===========================================
      // Load shared report if ID in URL
      //===========================================
      // Check for shared report ID in URL
      const urlParams = new URLSearchParams(window.location.search);
      const shareId = urlParams.get('id');
      
      if (shareId) {
        // Try to load shared report
        const sharedDataStr = localStorage.getItem(`trustbureau_share_${shareId}`) || 
                             localStorage.getItem('trustbureau_last_report');
        
        if (sharedDataStr) {
          try {
            sharedReportData = JSON.parse(sharedDataStr);
            renderReport(sharedReportData, 'sharedReportContent');
            document.getElementById('sharedReportSection').classList.remove('hidden');
            document.getElementById('noDataMessage').classList.add('hidden');
            
            // Update timestamp if available
            if (sharedReportData.timestamp) {
              const timestampEl = document.getElementById('sharedReportTimestamp');
              if (timestampEl) {
                timestampEl.textContent = `Shared report snapshot • Generated: ${new Date(sharedReportData.timestamp).toLocaleString()}`;
              }
            }
          } catch (e) {
            console.error('Failed to parse shared report data:', e);
            document.getElementById('noDataMessage').classList.add('hidden');
          }
        } else {
          document.getElementById('noDataMessage').classList.remove('hidden');
        }
      } else {
        // No share ID, show no data message
        document.getElementById('noDataMessage').classList.remove('hidden');
      }
    });
  </script>
</body>
</html>
