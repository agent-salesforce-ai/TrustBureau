<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Critical Financing | Offer Builder</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Poppins (matches your Critical Financing page) -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap"
    rel="stylesheet"
  />

  <style>
    :root {
      /* Backgrounds */
      --bg-body: #f4f6fb;
      --bg-card: #ffffff;
      --bg-card-inner: #f8fafc;

      /* Borders / lines */
      --border-primary: #e5e7eb;

      /* Brand colors (red / white / blue) */
      --brand-navy: #132347;
      --brand-blue: #264f9c;
      --brand-red: #c53030;

      /* Text */
      --text-primary: #111827;
      --text-secondary: #4b5563;
      --text-muted: #9ca3af;

      /* Slider track */
      --slider-track: #e5e7eb;
      --slider-thumb: #132347;

      /* Buttons */
      --btn-bg: #132347;
      --btn-bg-hover: #1d3162;
      --btn-text: #ffffff;

      /* Frequency toggle */
      --freq-bg: #ffffff;
      --freq-border: #e5e7eb;
      --freq-active-bg: #132347;
      --freq-active-text: #ffffff;
      --freq-inactive-bg: #ffffff;
      --freq-inactive-text: #4b5563;

      /* Live preview pill green */
      --live-green: #22c55e;
      --live-green-soft: rgba(34, 197, 94, 0.15);
    }

    body {
      font-family: 'Poppins', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI',
        sans-serif;
      background-color: var(--bg-body);
      color: var(--text-primary);
    }

    .shell {
      background-color: var(--bg-card);
      border-radius: 1.75rem;
      border: 1px solid #e5e7eb;
      box-shadow: 0 18px 45px rgba(15, 23, 42, 0.12);
    }

    .card-inner {
      background-color: var(--bg-card-inner);
      border-radius: 1.5rem;
      border: 1px solid var(--border-primary);
    }

    .field-label {
      font-size: 0.7rem;
      font-weight: 600;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      color: var(--text-secondary);
    }

    .field-input {
      border-radius: 0.9rem;
      border: 1px solid var(--border-primary);
      background-color: #ffffff;
      color: var(--text-primary);
      font-size: 0.875rem;
    }

    .field-input:focus {
      border-color: var(--brand-blue);
      box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.25);
      outline: none;
    }

    /* Sliders */
    .slider-track {
      width: 100%;
      height: 4px;
      border-radius: 999px;
      background-color: var(--slider-track);
      cursor: pointer;
    }

    input[type='range'].slider-track {
      -webkit-appearance: none;
      appearance: none;
    }

    input[type='range'].slider-track::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 16px;
      height: 16px;
      border-radius: 999px;
      background-color: var(--slider-thumb);
      border: 2px solid #ffffff;
      box-shadow: 0 0 0 2px rgba(19, 35, 71, 0.3);
      cursor: pointer;
    }

    input[type='range'].slider-track::-moz-range-thumb {
      width: 16px;
      height: 16px;
      border-radius: 999px;
      background-color: var(--slider-thumb);
      border: 2px solid #ffffff;
      box-shadow: 0 0 0 2px rgba(19, 35, 71, 0.3);
      cursor: pointer;
    }

    .freq-toggle {
      border-radius: 999px;
      border: 1px solid var(--freq-border);
      background-color: var(--freq-bg);
      padding: 4px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .freq-btn {
      border-radius: 999px;
      padding: 0.3rem 0.9rem;
      font-size: 0.75rem;
      font-weight: 600;
      border: none;
      cursor: pointer;
      background-color: transparent;
      color: var(--freq-inactive-text);
      transition: background-color 0.15s ease, color 0.15s ease;
    }

    .freq-btn.active {
      background-color: var(--freq-active-bg);
      color: var(--freq-active-text);
    }

    .primary-btn {
      border-radius: 999px;
      background-color: var(--btn-bg);
      color: var(--btn-text);
      font-size: 0.875rem;
      font-weight: 600;
      border: 1px solid rgba(15, 23, 42, 0.05);
      padding: 0.7rem 1.6rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.4rem;
      transition: background-color 0.15s ease, box-shadow 0.15s ease, transform 0.1s ease;
    }

    .primary-btn:hover {
      background-color: var(--btn-bg-hover);
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.18);
      transform: translateY(-1px);
    }

    .primary-btn:disabled {
      background-color: #e5e7eb;
      color: var(--text-muted);
      box-shadow: none;
      transform: none;
      cursor: not-allowed;
    }

    .hero-amount {
      color: var(--brand-navy);
      letter-spacing: -0.02em;
      text-shadow: 0 0 16px rgba(15, 23, 42, 0.06);
    }

    .live-pill {
      border-radius: 999px;
      background-color: #ffffff;
      border: 1px solid var(--border-primary);
      padding: 0.25rem 0.9rem;
      font-size: 0.7rem;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--text-secondary);
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      box-shadow: 0 6px 14px rgba(15, 23, 42, 0.08);
    }

    .live-dot-wrap {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .live-dot {
      width: 9px;
      height: 9px;
      border-radius: 999px;
      background-color: var(--live-green);
      box-shadow: 0 0 0 4px var(--live-green-soft);
    }

    /* Saved offer cards */
    .saved-card {
      border-radius: 1rem;
      border: 1px solid var(--border-primary);
      background-color: #ffffff;
    }

    /* Remove number spinners */
    input[type='number']::-webkit-inner-spin-button,
    input[type='number']::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    input[type='number'] {
      -moz-appearance: textfield;
    }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center px-3 py-8">
  <div class="w-full max-w-xl shell px-5 py-6 md:px-8 md:py-8 space-y-6">
    <!-- HEADER -->
    <header class="flex flex-col items-center gap-3 pb-4 border-b border-slate-200">
      <div class="flex flex-col items-center">
        <!-- Swap src for your actual Critical Financing logo -->
        <img
          src="https://static.wixstatic.com/media/1f882d_99935d5cbc724087b0185595d80ae6a8~mv2.png/v1/fill/w_240,h_106,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/1f882d_99935d5cbc724087b0185595d80ae6a8~mv2.png"
          alt="Critical Financing"
          class="h-10 w-auto"
        />
        <div
          class="mt-2 text-[0.7rem] tracking-[0.24em] uppercase text-slate-500 font-semibold"
        >
          Offer Builder
        </div>
      </div>
      <div class="live-pill">
        <span class="live-dot-wrap">
          <span class="live-dot"></span>
        </span>
        <span>Live Preview</span>
      </div>
    </header>

    <!-- INPUT CARD -->
    <section class="card-inner px-4 py-4 md:px-5 md:py-5 space-y-4">
      <!-- Business name -->
      <div class="space-y-1">
        <label for="businessNameInput" class="field-label">Business Name (optional)</label>
        <input
          id="businessNameInput"
          type="text"
          class="field-input w-full px-3 py-2"
          placeholder="e.g., Acme Holdings LLC"
        />
      </div>

      <!-- Amount -->
      <div class="space-y-2">
        <div class="flex items-center justify-between">
          <label class="field-label">Amount You Get</label>
          <span id="amountMaxLabel" class="text-[0.7rem] text-muted"></span>
        </div>
        <input
          id="calcAmountSlider"
          type="range"
          min="5000"
          max="1000000"
          step="1000"
          value="50000"
          class="slider-track"
        />
        <div class="relative">
          <span class="absolute left-3 top-1/2 -translate-y-1/2 text-sm text-muted">$</span>
          <input
            id="calcAmountInput"
            class="field-input w-full pl-7 pr-3 py-2"
            inputmode="numeric"
          />
        </div>
      </div>

      <!-- Factor -->
      <div class="space-y-2">
        <div class="flex items-center justify-between">
          <label class="field-label">Factor Rate</label>
          <span id="factorMaxLabel" class="text-[0.7rem] text-muted"></span>
        </div>
        <input
          id="calcFactorSlider"
          type="range"
          min="1.1"
          max="1.5"
          step="0.01"
          value="1.25"
          class="slider-track"
        />
        <div class="relative">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-4 w-4 absolute left-3 top-1/2 -translate-y-1/2 text-muted"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="2"
            stroke="currentColor"
          >
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
          </svg>
          <input
            id="calcFactorInput"
            type="number"
            step="0.01"
            class="field-input w-full pl-8 pr-3 py-2"
          />
        </div>
      </div>

      <!-- Term -->
      <div class="space-y-2">
        <div class="flex items-center justify-between">
          <label class="field-label">Term (Months)</label>
          <span id="termMaxLabel" class="text-[0.7rem] text-muted"></span>
        </div>
        <input
          id="calcTermSlider"
          type="range"
          min="3"
          max="24"
          step="1"
          value="12"
          class="slider-track"
        />
        <div class="relative">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-4 w-4 absolute left-3 top-1/2 -translate-y-1/2 text-muted"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="2"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2z"
            />
          </svg>
          <input
            id="calcTermInput"
            type="number"
            step="1"
            class="field-input w-full pl-8 pr-3 py-2"
          />
        </div>
      </div>

      <!-- Frequency -->
      <div class="flex justify-center pt-1">
        <div class="freq-toggle">
          <button id="toggleDaily" class="freq-btn active" type="button">Daily</button>
          <button id="toggleWeekly" class="freq-btn" type="button">Weekly</button>
          <button id="toggleMonthly" class="freq-btn" type="button">Monthly</button>
        </div>
      </div>
    </section>

    <!-- SUMMARY CARD -->
    <section class="rounded-2xl border border-slate-200 bg-white px-4 py-5 md:px-6 md:py-6">
      <div class="text-center space-y-1">
        <span
          id="businessNameDisplay"
          class="text-xs font-semibold text-slate-500 tracking-wide hidden"
        ></span>
        <div class="text-xs font-semibold text-slate-500 uppercase tracking-[0.16em]">
          You get
        </div>
        <div
          id="summaryAmountOut"
          class="hero-amount text-4xl md:text-5xl font-semibold mt-1 mb-1"
        >
          $50,000
        </div>
        <div class="text-sm text-slate-600">
          Total payback:
          <span id="summaryPaybackOut" class="font-semibold text-slate-800"></span>
        </div>
      </div>

      <div class="mt-5 border-t border-slate-200 pt-4">
        <div class="grid grid-cols-2 gap-4 text-center">
          <div class="space-y-1">
            <div class="field-label">Factor Rate</div>
            <div id="summaryFactorOut" class="text-lg font-semibold text-slate-900"></div>
          </div>
          <div class="space-y-1">
            <div class="field-label">Term</div>
            <div id="summaryTermOut" class="text-lg font-semibold text-slate-900"></div>
          </div>
          <div class="space-y-1">
            <div class="field-label">Total Cost of Funds</div>
            <div id="summaryCostOut" class="text-lg font-semibold text-slate-900"></div>
          </div>
          <div class="space-y-1">
            <div id="summaryPaymentLabel" class="field-label">Est. Daily Payment</div>
            <div
              id="summaryPaymentValue"
              class="text-lg font-semibold text-slate-900"
            ></div>
          </div>
        </div>
      </div>
    </section>

    <!-- ADDITIONAL OFFERS -->
    <section
      id="savedOffersSection"
      class="rounded-2xl border border-slate-200 bg-white px-4 py-4 md:px-5 md:py-5 hidden"
    >
      <div class="flex items-center justify-between mb-3">
        <h3 class="text-sm font-semibold text-slate-700">Additional Offers</h3>
      </div>
      <div id="savedOffersContainer" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
    </section>

    <!-- BUTTONS -->
    <section class="pt-1 border-t border-slate-200 mt-2">
      <div class="flex flex-col sm:flex-row justify-center gap-3 pt-4">
        <button id="addOfferButton" class="primary-btn w-full sm:w-auto" type="button">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-4 w-4"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="2"
            stroke="currentColor"
          >
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
          </svg>
          <span>+ Add Offer</span>
        </button>
        <button id="shareLinkButton" class="primary-btn w-full sm:w-auto" type="button">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-4 w-4"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="2"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M8.684 13.342C8.886 12.938 9 12.482 9 12s-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684z"
            />
          </svg>
          <span>Copy Shareable Link</span>
        </button>
      </div>
    </section>
  </div>

  <script>
    // --- Utility functions ---
    function formatCurrency(num) {
      if (!isFinite(num)) return '$0';
      return num.toLocaleString('en-US', {
        style: 'currency',
        currency: 'USD',
        maximumFractionDigits: 0,
      });
    }

    function clamp(value, min, max) {
      return Math.min(Math.max(value, min), max);
    }

    // --- Elements ---
    const amountSlider = document.getElementById('calcAmountSlider');
    const amountInput = document.getElementById('calcAmountInput');
    const factorSlider = document.getElementById('calcFactorSlider');
    const factorInput = document.getElementById('calcFactorInput');
    const termSlider = document.getElementById('calcTermSlider');
    const termInput = document.getElementById('calcTermInput');

    const amountMaxLabel = document.getElementById('amountMaxLabel');
    const factorMaxLabel = document.getElementById('factorMaxLabel');
    const termMaxLabel = document.getElementById('termMaxLabel');

    const businessNameInput = document.getElementById('businessNameInput');
    const businessNameDisplay = document.getElementById('businessNameDisplay');

    const summaryAmountOut = document.getElementById('summaryAmountOut');
    const summaryPaybackOut = document.getElementById('summaryPaybackOut');
    const summaryFactorOut = document.getElementById('summaryFactorOut');
    const summaryTermOut = document.getElementById('summaryTermOut');
    const summaryCostOut = document.getElementById('summaryCostOut');
    const summaryPaymentLabel = document.getElementById('summaryPaymentLabel');
    const summaryPaymentValue = document.getElementById('summaryPaymentValue');

    const toggleDaily = document.getElementById('toggleDaily');
    const toggleWeekly = document.getElementById('toggleWeekly');
    const toggleMonthly = document.getElementById('toggleMonthly');

    const addOfferButton = document.getElementById('addOfferButton');
    const shareLinkButton = document.getElementById('shareLinkButton');
    const savedOffersSection = document.getElementById('savedOffersSection');
    const savedOffersContainer = document.getElementById('savedOffersContainer');

    // State
    const state = {
      amount: parseInt(amountSlider.value, 10),
      factor: parseFloat(factorSlider.value),
      termMonths: parseInt(termSlider.value, 10),
      frequency: 'daily',
      savedOffers: [],
    };

    // Pre-fill labels for min/max
    amountMaxLabel.textContent = formatCurrency(parseInt(amountSlider.max, 10));
    factorMaxLabel.textContent = `${parseFloat(factorSlider.value).toFixed(2)}x`;
    termMaxLabel.textContent = `${termSlider.max} months`;

    function updateBusinessName() {
      const name = businessNameInput.value.trim();
      if (name) {
        businessNameDisplay.textContent = name;
        businessNameDisplay.classList.remove('hidden');
      } else {
        businessNameDisplay.textContent = '';
        businessNameDisplay.classList.add('hidden');
      }
    }

    function computeSchedule(amount, factor, termMonths, frequency) {
      const payback = amount * factor;
      const cost = payback - amount;

      let payments = 0;
      if (frequency === 'daily') {
        // assume 21 business days per month
        payments = termMonths * 21;
      } else if (frequency === 'weekly') {
        payments = Math.round((termMonths * 21) / 5);
      } else {
        payments = termMonths;
      }

      const payment = payments > 0 ? payback / payments : 0;
      return { payback, cost, payments, payment };
    }

    function refreshSummary() {
      const { amount, factor, termMonths, frequency } = state;
      const { payback, cost, payments, payment } = computeSchedule(
        amount,
        factor,
        termMonths,
        frequency
      );

      summaryAmountOut.textContent = formatCurrency(amount);
      summaryPaybackOut.textContent = formatCurrency(payback);
      summaryFactorOut.textContent = `${factor.toFixed(2)}x`;
      summaryTermOut.textContent = `${termMonths} months`;
      summaryCostOut.textContent = formatCurrency(cost);

      if (frequency === 'daily') {
        summaryPaymentLabel.textContent = 'Est. Daily Payment';
      } else if (frequency === 'weekly') {
        summaryPaymentLabel.textContent = 'Est. Weekly Payment';
      } else {
        summaryPaymentLabel.textContent = 'Est. Monthly Payment';
      }
      summaryPaymentValue.textContent = `${formatCurrency(payment)}${
        payments ? '' : ''
      }`;

      updateBusinessName();
    }

    // --- Sync functions ---
    function syncAmountFromSlider() {
      const raw = parseInt(amountSlider.value, 10) || 0;
      state.amount = clamp(raw, parseInt(amountSlider.min, 10), parseInt(amountSlider.max, 10));
      amountSlider.value = state.amount;
      amountInput.value = state.amount.toLocaleString('en-US');
      refreshSummary();
    }

    function syncAmountFromInput() {
      const numeric = parseInt(amountInput.value.replace(/[^0-9]/g, ''), 10) || 0;
      state.amount = clamp(
        numeric,
        parseInt(amountSlider.min, 10),
        parseInt(amountSlider.max, 10)
      );
      amountSlider.value = state.amount;
      amountInput.value = state.amount.toLocaleString('en-US');
      refreshSummary();
    }

    function syncFactorFromSlider() {
      const raw = parseFloat(factorSlider.value) || 1.0;
      state.factor = clamp(raw, parseFloat(factorSlider.min), parseFloat(factorSlider.max));
      factorSlider.value = state.factor.toFixed(2);
      factorInput.value = state.factor.toFixed(2);
      factorMaxLabel.textContent = `${parseFloat(factorSlider.max).toFixed(2)}x`;
      refreshSummary();
    }

    function syncFactorFromInput() {
      const raw = parseFloat(factorInput.value) || 1.0;
      state.factor = clamp(raw, parseFloat(factorSlider.min), parseFloat(factorSlider.max));
      factorSlider.value = state.factor.toFixed(2);
      factorInput.value = state.factor.toFixed(2);
      refreshSummary();
    }

    function syncTermFromSlider() {
      const raw = parseInt(termSlider.value, 10) || 0;
      state.termMonths = clamp(
        raw,
        parseInt(termSlider.min, 10),
        parseInt(termSlider.max, 10)
      );
      termSlider.value = state.termMonths;
      termInput.value = state.termMonths;
      termMaxLabel.textContent = `${termSlider.max} months`;
      refreshSummary();
    }

    function syncTermFromInput() {
      const raw = parseInt(termInput.value, 10) || 0;
      state.termMonths = clamp(
        raw,
        parseInt(termSlider.min, 10),
        parseInt(termSlider.max, 10)
      );
      termSlider.value = state.termMonths;
      termInput.value = state.termMonths;
      refreshSummary();
    }

    function setFrequency(freq) {
      state.frequency = freq;
      toggleDaily.classList.toggle('active', freq === 'daily');
      toggleWeekly.classList.toggle('active', freq === 'weekly');
      toggleMonthly.classList.toggle('active', freq === 'monthly');
      refreshSummary();
    }

    // --- Saved offers ---
    function renderSavedOffers() {
      savedOffersContainer.innerHTML = '';
      if (!state.savedOffers.length) {
        savedOffersSection.classList.add('hidden');
        return;
      }
      savedOffersSection.classList.remove('hidden');

      state.savedOffers.forEach((offer, index) => {
        const card = document.createElement('div');
        card.className = 'saved-card px-3 py-3 space-y-2';

        const headerRow = document.createElement('div');
        headerRow.className = 'flex items-center justify-between';

        const title = document.createElement('div');
        title.className = 'text-xs font-semibold text-slate-600 uppercase tracking-wide';
        title.textContent = `Offer ${index + 1}`;

        const removeBtn = document.createElement('button');
        removeBtn.type = 'button';
        removeBtn.className = 'text-xs text-slate-400 hover:text-slate-600';
        removeBtn.textContent = 'Remove';
        removeBtn.addEventListener('click', () => {
          state.savedOffers.splice(index, 1);
          renderSavedOffers();
        });

        headerRow.appendChild(title);
        headerRow.appendChild(removeBtn);

        const amountEl = document.createElement('div');
        amountEl.className = 'text-lg font-semibold text-slate-900';
        amountEl.textContent = formatCurrency(offer.amount);

        const paybackEl = document.createElement('div');
        paybackEl.className = 'text-xs text-slate-500';
        paybackEl.textContent = `Total payback ${formatCurrency(offer.payback)} · ${
          offer.termMonths
        } mo · ${offer.factor.toFixed(2)}x`;

        const paymentEl = document.createElement('div');
        paymentEl.className = 'text-xs text-slate-600';
        const label =
          offer.frequency === 'daily'
            ? 'Est. Daily Payment'
            : offer.frequency === 'weekly'
            ? 'Est. Weekly Payment'
            : 'Est. Monthly Payment';
        paymentEl.textContent = `${label} ${formatCurrency(offer.payment)}`;

        card.appendChild(headerRow);
        card.appendChild(amountEl);
        card.appendChild(paybackEl);
        card.appendChild(paymentEl);

        savedOffersContainer.appendChild(card);
      });
    }

    function handleAddOffer() {
      const { amount, factor, termMonths, frequency } = state;
      const { payback, cost, payments, payment } = computeSchedule(
        amount,
        factor,
        termMonths,
        frequency
      );

      state.savedOffers.push({
        amount,
        factor,
        termMonths,
        frequency,
        payback,
        cost,
        payments,
        payment,
      });

      renderSavedOffers();
    }

    // --- Share link ---
    function handleShareLink() {
      const params = new URLSearchParams();
      params.set('a', String(state.amount));
      params.set('f', String(state.factor));
      params.set('t', String(state.termMonths));
      params.set('q', state.frequency);

      const url = `${window.location.origin}${window.location.pathname}?${params.toString()}`;

      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard
          .writeText(url)
          .then(() => {
            shareLinkButton.textContent = 'Link Copied!';
            setTimeout(() => {
              shareLinkButton.innerHTML =
                '<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.684 13.342C8.886 12.938 9 12.482 9 12s-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684z"/></svg><span>Copy Shareable Link</span>';
            }, 1600);
          })
          .catch(() => {
            alert(url);
          });
      } else {
        alert(url);
      }
    }

    // --- Event listeners ---
    amountSlider.addEventListener('input', syncAmountFromSlider);
    amountInput.addEventListener('change', syncAmountFromInput);
    amountInput.addEventListener('blur', syncAmountFromInput);

    factorSlider.addEventListener('input', syncFactorFromSlider);
    factorInput.addEventListener('change', syncFactorFromInput);
    factorInput.addEventListener('blur', syncFactorFromInput);

    termSlider.addEventListener('input', syncTermFromSlider);
    termInput.addEventListener('change', syncTermFromInput);
    termInput.addEventListener('blur', syncTermFromInput);

    businessNameInput.addEventListener('input', updateBusinessName);

    toggleDaily.addEventListener('click', () => setFrequency('daily'));
    toggleWeekly.addEventListener('click', () => setFrequency('weekly'));
    toggleMonthly.addEventListener('click', () => setFrequency('monthly'));

    addOfferButton.addEventListener('click', handleAddOffer);
    shareLinkButton.addEventListener('click', handleShareLink);

    // --- Init ---
    function initFromQuery() {
      const params = new URLSearchParams(window.location.search);
      const a = parseInt(params.get('a') || '', 10);
      const f = parseFloat(params.get('f') || '');
      const t = parseInt(params.get('t') || '', 10);
      const q = params.get('q');

      if (!Number.isNaN(a)) {
        state.amount = clamp(a, parseInt(amountSlider.min, 10), parseInt(amountSlider.max, 10));
      }
      if (!Number.isNaN(f)) {
        state.factor = clamp(f, parseFloat(factorSlider.min), parseFloat(factorSlider.max));
      }
      if (!Number.isNaN(t)) {
        state.termMonths = clamp(
          t,
          parseInt(termSlider.min, 10),
          parseInt(termSlider.max, 10)
        );
      }
      if (q === 'daily' || q === 'weekly' || q === 'monthly') {
        state.frequency = q;
      }

      amountSlider.value = state.amount;
      amountInput.value = state.amount.toLocaleString('en-US');

      factorSlider.value = state.factor.toFixed(2);
      factorInput.value = state.factor.toFixed(2);

      termSlider.value = state.termMonths;
      termInput.value = state.termMonths;

      setFrequency(state.frequency);
      refreshSummary();
    }

    initFromQuery();
  </script>
</body>
</html>
