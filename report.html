<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Trust Bureau - Forensic Aggregator v8.1 (Stable)</title>
  <meta name="theme-color" content="#F8FAFC" />

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Plus+Jakarta+Sans:wght@500;600;700;800;900&family=JetBrains+Mono:wght@400;500;700&display=swap"
    rel="stylesheet"
  />

  <!-- Tailwind Config -->
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            heading: ['Plus Jakarta Sans', 'sans-serif'],
            sans: ['Inter', 'sans-serif'],
            mono: ['JetBrains Mono', 'monospace']
          },
          colors: {
            'brand-primary': '#18181b', // Zinc 900
            'brand-dark': '#09090b', // Zinc 950
            'brand-gray': '#71717a', // Zinc 500
            'brand-bg': '#fafafa', // Zinc 50
            'brand-border': '#e4e4e7' // Zinc 200
          },
          boxShadow: {
            card: '0 4px 15px rgba(24, 24, 27, 0.05)',
            soft: '0 2px 10px rgba(0,0,0,0.03)'
          },
          animation: {
            'fade-in-up': 'fade-in-up 0.6s ease-out both'
          },
          keyframes: {
            'fade-in-up': {
              '0%': { opacity: '0', transform: 'translateY(15px)' },
              '100%': { opacity: '1', transform: 'translateY(0)' }
            }
          }
        }
      }
    };
  </script>

  <!-- Custom CSS -->
  <style>
    body { background-color: #fafafa; color: #18181b; font-family: 'Inter', sans-serif; }
    
    /* Scrollbar Styling */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background-color: #d4d4d8; border-radius: 20px; }
    
    /* Forensic Table */
    .forensic-table { width: 100%; border-collapse: separate; border-spacing: 0; font-size: 0.85rem; }
    .forensic-table th {
      text-align: left; padding: 12px 16px; background: #f4f4f5; color: #52525b; font-weight: 700;
      text-transform: uppercase; font-size: 0.7rem; letter-spacing: 0.05em;
      border-bottom: 1px solid #e4e4e7; white-space: nowrap; position: sticky; top: 0; z-index: 10;
    }
    .forensic-table td { padding: 14px 16px; border-bottom: 1px solid #f4f4f5; vertical-align: top; color: #27272a; }
    .forensic-table tr:hover td { background-color: #fafafa; }

    /* SVG Gauge */
    .risk-gauge-svg { transform: rotate(-90deg); }
    .risk-gauge-progress { transition: stroke-dashoffset 1.2s cubic-bezier(0.4, 0, 0.2, 1); stroke-linecap: round; }

    /* Enhance Button */
    .enhance-btn {
      font-size: 0.75rem; font-weight: 700; letter-spacing: 0.05em; color: #18181b; background: #fff;
      border: 1px solid #d4d4d8; padding: 6px 14px; border-radius: 999px; display: flex; align-items: center;
      gap: 6px; transition: all 0.2s ease; box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }
    .enhance-btn:hover:not(:disabled) { background: #f4f4f5; border-color: #a1a1aa; transform: translateY(-1px); box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
    .enhance-btn:active { transform: translateY(0); }

    /* Links */
    a.data-link { color: #18181b; text-decoration: none; border-bottom: 1px dotted #a1a1aa; font-weight: 600; transition: all 0.2s; }
    a.data-link:hover { background-color: #f4f4f5; border-bottom-style: solid; border-color: #000; color: #000; }

    /* Labels & Values */
    .label-text { font-size: 0.7rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; color: #71717a; margin-bottom: 4px; display: block; }
    .value-text { font-size: 0.95rem; font-weight: 500; color: #09090b; line-height: 1.5; }
    
    /* Empty State Styling */
    .empty-value { color: #a1a1aa; font-weight: 400; font-style: italic; }

    /* Nav Pills */
    .nav-pill {
      display: flex; align-items: center; padding: 10px 16px; border-radius: 8px; font-size: 0.875rem; font-weight: 600; color: #71717a;
      text-decoration: none; transition: all 0.2s; margin-bottom: 2px;
    }
    .nav-pill:hover { background-color: #f4f4f5; color: #18181b; }
    .nav-pill.active { background-color: #18181b; color: #ffffff; }

    /* Loading Overlay */
    .section-loading {
      position: absolute; inset: 0; background: rgba(255,255,255,0.85); backdrop-filter: blur(2px); z-index: 50;
      display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 0.75rem;
    }

    /* Hero Background */
    .hero-bg { background: radial-gradient(circle at 50% 0%, #fafafa 0%, #e4e4e7 100%); }
    
    /* Loader Scan Line */
    .scan-line { width: 100%; height: 3px; background: linear-gradient(90deg, transparent, #18181b, transparent); animation: scan 1.5s linear infinite; }
    @keyframes scan { 0% { transform: translateX(-100%); } 100% { transform: translateX(100%); } }

    /* Toast */
    #error-toast { transition: all 0.3s ease-out; transform: translateY(-150%); opacity: 0; }
    #error-toast.show { transform: translateY(0); opacity: 1; }
  </style>
</head>

<body class="antialiased min-h-screen flex flex-col">

  <!-- ERROR TOAST -->
  <div id="error-toast" class="fixed top-6 left-0 right-0 z-[100] flex justify-center pointer-events-none">
    <div class="bg-red-600 text-white px-6 py-4 rounded-lg shadow-2xl flex items-center gap-4 pointer-events-auto max-w-xl mx-4 border border-red-500">
      <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
      <span id="error-message" class="font-medium text-sm break-all">An error occurred.</span>
    </div>
  </div>

  <!-- HEADER -->
  <header id="main-header" class="sticky top-0 z-50 bg-white/80 backdrop-blur-xl border-b border-brand-border shadow-sm">
    <div class="max-w-[1500px] mx-auto px-4 md:px-8 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3 cursor-pointer group" onclick="location.reload()">
        <div class="w-9 h-9 bg-brand-primary rounded flex items-center justify-center shadow-lg shadow-zinc-500/20 group-hover:scale-105 transition-transform">
          <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2L1 21h22L12 2zm0 5.5l5.5 9.5h-11L12 7.5z"/></svg>
        </div>
        <h1 class="font-heading font-black text-lg text-brand-dark tracking-tight uppercase">Trust Bureau <span class="hidden sm:inline opacity-50 font-medium text-xs align-top ml-1">v8.1</span></h1>
      </div>

      <div class="flex items-center gap-3">
        <button id="settings-btn" class="text-brand-gray hover:text-brand-dark p-2 rounded-full hover:bg-gray-100 transition-colors">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
        </button>
        <div class="hidden md:flex items-center gap-2 px-3 py-1 bg-green-50 border border-green-200 rounded-full">
          <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
          <span class="text-[10px] font-bold text-green-800 uppercase tracking-wide">System Online</span>
        </div>
      </div>
    </div>
  </header>

  <!-- MAIN CONTENT -->
  <main class="flex-grow relative">
    
    <!-- SEARCH VIEW -->
    <div id="search-view" class="hero-bg absolute inset-0 z-10 flex flex-col items-center justify-center p-4 text-center transition-all duration-500">
      <div class="absolute top-1/4 left-1/4 w-64 h-64 bg-zinc-300/20 rounded-full blur-3xl pointer-events-none"></div>
      
      <div class="inline-flex items-center gap-2 bg-white/50 border border-zinc-200 backdrop-blur px-4 py-1.5 rounded-full text-xs font-semibold text-brand-gray mb-8">
        <span class="w-1.5 h-1.5 rounded-full bg-brand-primary"></span> Live Aggregation
      </div>

      <h2 class="text-4xl md:text-7xl font-heading font-black text-brand-dark mb-6 tracking-tighter leading-[0.9]">
        Forensic Data <br />
        <span class="text-zinc-400">Extraction.</span>
      </h2>

      <p class="text-brand-gray mb-10 text-lg max-w-xl">
        Corporate Filings • Litigation History • Consumer Sentiment • Compliance • Financial Firmographics
      </p>

      <div class="w-full max-w-2xl relative group">
        <div class="bg-white p-2 rounded-2xl shadow-2xl shadow-zinc-200/50 border border-zinc-200 flex flex-col sm:flex-row gap-2 transition-shadow group-hover:shadow-zinc-300/50 focus-within:ring-4 focus-within:ring-zinc-100">
          <div class="flex-grow relative flex items-center">
            <svg class="w-5 h-5 text-zinc-400 absolute left-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
            <input type="text" id="search-input" class="w-full bg-transparent border-none outline-none pl-12 pr-4 py-3 text-lg font-medium text-brand-dark placeholder-zinc-400" placeholder="Entity name (e.g., Neuralink, Tesla)" />
          </div>
          <button id="generate-btn" class="bg-brand-primary text-white px-8 py-3 rounded-xl font-bold hover:bg-black transition-colors active:scale-95">
            Begin Audit
          </button>
        </div>
      </div>

      <div class="mt-12 flex gap-2 flex-wrap justify-center opacity-60">
        <button onclick="window.runSearch('OpenAI')" class="text-xs font-semibold bg-white border border-zinc-200 px-3 py-1 rounded-full hover:border-brand-primary hover:text-black transition-colors">OpenAI</button>
        <button onclick="window.runSearch('Stripe')" class="text-xs font-semibold bg-white border border-zinc-200 px-3 py-1 rounded-full hover:border-brand-primary hover:text-black transition-colors">Stripe</button>
        <button onclick="window.runSearch('SpaceX')" class="text-xs font-semibold bg-white border border-zinc-200 px-3 py-1 rounded-full hover:border-brand-primary hover:text-black transition-colors">SpaceX</button>
      </div>
    </div>

    <!-- LOADER VIEW -->
    <div id="loader-view" class="hidden absolute inset-0 z-20 bg-brand-bg/90 backdrop-blur-sm flex flex-col items-center justify-center p-4">
      <div class="bg-white p-10 rounded-2xl shadow-2xl border border-brand-border max-w-md w-full text-center">
        <!-- Professional Spinner -->
        <div class="relative w-12 h-12 mx-auto mb-6">
           <div class="absolute inset-0 border-4 border-zinc-100 rounded-full"></div>
           <div class="absolute inset-0 border-4 border-t-brand-primary rounded-full animate-spin"></div>
        </div>

        <h3 class="text-xl font-heading font-bold text-brand-dark mb-2">Forensic Deep Scan</h3>
        <p id="loader-step" class="text-sm text-brand-gray font-medium mb-8 min-h-[1.25rem]">Initializing secure connection...</p>
        
        <!-- Progress Bar -->
        <div class="h-1.5 w-full bg-zinc-100 rounded-full overflow-hidden relative">
           <div class="absolute inset-y-0 left-0 bg-brand-primary w-1/3 animate-[loading_2s_ease-in-out_infinite]"></div>
        </div>
        <style> @keyframes loading { 0% { left: -35%; width: 30%; } 50% { width: 60%; } 100% { left: 100%; width: 30%; } } </style>
      </div>
      
      <div class="mt-6 text-[10px] text-zinc-400 font-medium uppercase tracking-widest">
        Trust Bureau Forensic Engine v8.1
      </div>
    </div>

    <!-- REPORT VIEW -->
    <div id="report-view" class="hidden relative z-30 max-w-[1600px] mx-auto px-4 md:px-8 py-8">
      
      <!-- HEADER INFO CARD -->
      <div id="sec-header" class="bg-white border border-brand-border rounded-2xl p-6 md:p-8 shadow-card mb-8 animate-fade-in-up">
        <div class="flex flex-col xl:flex-row justify-between gap-8">
          <div class="flex-grow">
            <div class="flex flex-wrap items-center gap-4 mb-3">
               <h1 id="h-name" class="text-3xl md:text-5xl font-heading font-extrabold text-brand-dark tracking-tight">--</h1>
               <span id="sos-badge" class="text-xs font-bold px-3 py-1 rounded-full border border-gray-200 bg-gray-50 text-gray-500 uppercase tracking-wide">Verifying</span>
            </div>
            
            <div class="flex flex-wrap gap-y-2 gap-x-6 text-sm text-brand-gray mb-6">
              <div class="flex items-center gap-2">
                <svg class="w-4 h-4 text-zinc-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                <span id="h-loc" class="font-medium text-brand-dark">--</span>
              </div>
              <div class="flex items-center gap-2">
                 <svg class="w-4 h-4 text-zinc-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"></path></svg>
                 <a id="h-web" href="#" target="_blank" class="data-link">--</a>
              </div>
              <div id="h-founded-container" class="hidden flex items-center gap-2 border-l pl-6 border-zinc-200">
                 <span class="text-xs font-mono text-zinc-400">ESTABLISHED</span>
                 <span id="h-founded" class="font-bold text-brand-dark">--</span>
              </div>
            </div>

            <div class="bg-zinc-50 border-l-4 border-brand-primary p-5 rounded-r-xl">
              <h4 class="text-[10px] font-black uppercase tracking-widest text-zinc-400 mb-2">AI Forensic Analysis</h4>
              <p id="h-memo" class="text-sm md:text-base text-zinc-800 leading-relaxed">Generating summary...</p>
            </div>
          </div>

          <div class="flex-shrink-0 flex flex-col items-center justify-center xl:border-l xl:border-zinc-100 xl:pl-8 min-w-[220px]">
             <button id="reverify-btn" class="mb-6 enhance-btn w-full justify-center bg-zinc-900 text-white border-zinc-900 hover:bg-zinc-700 text-xs">
               <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
               Re-Audit Entity
             </button>
             
             <div class="relative w-32 h-32 mb-2">
                <svg class="risk-gauge-svg w-full h-full" viewBox="0 0 100 100">
                  <circle cx="50" cy="50" r="45" fill="none" stroke="#f4f4f5" stroke-width="8"></circle>
                  <circle id="g-circle-progress" class="risk-gauge-progress" cx="50" cy="50" r="45" fill="none" stroke="#71717a" stroke-width="8" stroke-dasharray="283" stroke-dashoffset="283"></circle>
                </svg>
                <div class="absolute inset-0 flex flex-col items-center justify-center">
                   <span id="g-score" class="text-3xl font-black text-brand-dark leading-none">--</span>
                   <span class="text-[9px] font-bold uppercase text-zinc-400 mt-1">Trust Score</span>
                </div>
             </div>
             <div id="g-badge" class="px-4 py-1 rounded text-xs font-bold uppercase tracking-wider bg-zinc-200 text-zinc-500">Pending</div>
          </div>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        <!-- SIDEBAR NAV -->
        <div class="lg:col-span-2 hidden lg:block">
          <div id="report-nav" class="sticky top-24 space-y-1" style="animation: fade-in-up 0.6s ease-out 0.1s both;">
             <h3 class="text-xs font-bold text-zinc-400 uppercase tracking-wider px-4 mb-3">Modules</h3>
             <a href="#sec-sos" class="nav-pill active" data-nav="sec-sos">Corporate Filings</a>
             <a href="#sec-leadership" class="nav-pill" data-nav="sec-leadership">Principals & Execs</a>
             <!-- Financials Removed -->
             <a href="#sec-digital" class="nav-pill" data-nav="sec-digital">Digital Footprint</a>
             <a href="#sec-litigation" class="nav-pill" data-nav="sec-litigation">Litigation & UCC</a>
             <a href="#sec-reputation" class="nav-pill" data-nav="sec-reputation">Reputation (BBB)</a>
             <a href="#sec-reviews" class="nav-pill" data-nav="sec-reviews">Customer Voice (6+)</a>
             <a href="#sec-compliance" class="nav-pill" data-nav="sec-compliance">Compliance</a>
             <a href="#sec-sources" class="nav-pill" data-nav="sec-sources">Evidence</a>
          </div>
        </div>

        <!-- MAIN STACK -->
        <div class="lg:col-span-10 space-y-0 min-w-0">
           
           <!-- SOS MODULE -->
           <div id="sec-sos" class="report-section mt-8 pt-8 border-t border-brand-border first:mt-0 first:pt-0 first:border-t-0">
              <div class="flex justify-between items-center mb-4">
                 <h3 class="text-zinc-500 font-bold text-xs uppercase tracking-widest flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path></svg>
                    Official Corporate Filings
                 </h3>
                 <button class="enhance-btn text-xs" data-section="sos">Deep Search</button>
              </div>
              <div class="bg-white border border-brand-border rounded-xl shadow-sm p-6 grid grid-cols-1 sm:grid-cols-2 gap-y-6 gap-x-4">
                 <div class="col-span-1 sm:col-span-2">
                    <span class="label-text">Legal Entity Name</span>
                    <div id="c-name" class="value-text text-lg font-bold">--</div>
                 </div>
                 <div>
                    <span class="label-text">Registration / Entity ID</span>
                    <div id="c-id" class="value-text font-mono bg-zinc-100 px-2 py-1 rounded inline-block text-sm">--</div>
                 </div>
                 <div>
                    <span class="label-text">Jurisdiction (State)</span>
                    <div id="c-state" class="value-text">--</div>
                 </div>
                 <div>
                    <span class="label-text">Formation Date</span>
                    <div id="c-date" class="value-text">--</div>
                 </div>
                 <div>
                    <span class="label-text">Registered Agent</span>
                    <div id="c-agent" class="value-text text-sm">--</div>
                 </div>
              </div>
           </div>

           <!-- LEADERSHIP MODULE -->
           <div id="sec-leadership" class="report-section mt-8 pt-8 border-t border-brand-border">
              <div class="flex justify-between items-center mb-4">
                 <h3 class="text-zinc-500 font-bold text-xs uppercase tracking-widest flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                    Principals & Leadership
                 </h3>
                 <button class="enhance-btn text-xs" data-section="leadership">Investigate</button>
              </div>
              <div class="bg-white border border-brand-border rounded-xl shadow-sm p-6">
                 <div id="leadership-list" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                     <!-- Filled by JS -->
                 </div>
              </div>
           </div>

           <!-- Financials Module Removed -->

           <!-- DIGITAL FOOTPRINT -->
           <div id="sec-digital" class="report-section mt-8 pt-8 border-t border-brand-border">
              <div class="flex justify-between items-center mb-4">
                 <h3 class="text-zinc-500 font-bold text-xs uppercase tracking-widest flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"></path></svg>
                    Digital Footprint
                 </h3>
                 <button class="enhance-btn text-xs" data-section="digital">Scan</button>
              </div>
              <div class="bg-white border border-brand-border rounded-xl shadow-sm p-6">
                  <ul class="space-y-3 text-sm">
                     <li class="flex justify-between items-center border-b border-zinc-100 pb-2 last:border-0 last:pb-0">
                        <span class="label-text">Primary Domain</span>
                        <div id="d-domain" class="font-mono text-brand-primary truncate font-bold text-sm">--</div>
                     </li>
                     <li class="flex justify-between items-center border-b border-zinc-100 pb-2 last:border-0 last:pb-0">
                        <span class="label-text">Domain Age</span>
                        <div id="d-age" class="font-medium text-sm">--</div>
                     </li>
                     <li class="flex flex-col gap-2 pt-1">
                        <span class="label-text">Tech Stack</span>
                        <div id="d-tech" class="flex flex-wrap gap-1"></div>
                     </li>
                  </ul>
              </div>
           </div>

           <!-- LITIGATION MODULE -->
           <div id="sec-litigation" class="report-section mt-8 pt-8 border-t border-brand-border">
              <div class="flex justify-between items-center mb-4">
                 <h3 class="text-zinc-500 font-bold text-xs uppercase tracking-widest flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3"></path></svg>
                    Legal, Liens & Litigation
                 </h3>
                 <button class="enhance-btn text-xs" data-section="litigation">Check Dockets</button>
              </div>
              <div class="overflow-x-auto max-h-[400px] bg-white border border-brand-border rounded-xl shadow-sm">
                 <table class="forensic-table min-w-[700px]">
                    <thead>
                       <tr>
                          <th class="w-[15%]">Type</th>
                          <th class="w-[20%]">Case ID</th>
                          <th class="w-[35%]">Parties / Plaintiff</th>
                          <th class="w-[15%]">Date</th>
                          <th class="w-[15%]">Status</th>
                       </tr>
                    </thead>
                    <tbody id="legal-rows"></tbody>
                 </table>
                 <div id="legal-empty" class="p-8 text-center text-zinc-400 italic text-sm hidden border-t border-zinc-100">No adverse litigation records located in scan.</div>
              </div>
           </div>

           <!-- REPUTATION MODULE -->
           <div id="sec-reputation" class="report-section mt-8 pt-8 border-t border-brand-border">
              <div class="flex justify-between items-center mb-4">
                 <h3 class="text-zinc-500 font-bold text-xs uppercase tracking-widest flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    Bureau Rating (BBB)
                 </h3>
                 <button class="enhance-btn text-xs" data-section="reputation">Verify BBB</button>
              </div>
              <div class="bg-white border border-brand-border rounded-xl shadow-sm p-6 flex items-center gap-8">
                 <div class="text-center min-w-[100px]">
                    <span class="label-text mb-1">Grade</span>
                    <div id="bbb-grade" class="text-6xl font-black text-brand-dark tracking-tighter">--</div>
                 </div>
                 <div class="flex-grow border-l border-zinc-100 pl-8">
                    <div class="grid grid-cols-2 gap-4">
                       <div>
                          <span class="label-text">Accreditation</span>
                          <div id="bbb-status" class="value-text">--</div>
                       </div>
                       <div>
                          <span class="label-text">Complaints (3 Yr)</span>
                          <div id="bbb-complaints" class="value-text">--</div>
                       </div>
                    </div>
                    <div class="mt-3 pt-3 border-t border-zinc-100">
                        <span class="label-text block mb-1">Bureau Analysis</span>
                        <p id="bbb-summary" class="text-sm text-zinc-600 leading-relaxed">--</p>
                    </div>
                 </div>
              </div>
           </div>

           <!-- REVIEWS MODULE -->
           <div id="sec-reviews" class="report-section mt-8 pt-8 border-t border-brand-border">
              <div class="flex justify-between items-center mb-4">
                 <h3 class="text-zinc-500 font-bold text-xs uppercase tracking-widest flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"></path></svg>
                    Voice of Customer
                 </h3>
                 <button class="enhance-btn text-xs" data-section="reviews">Deep Scan</button>
              </div>
              <div class="bg-white border border-brand-border rounded-xl shadow-sm overflow-hidden">
                  <div id="reviews-list" class="divide-y divide-zinc-100 max-h-[600px] overflow-y-auto">
                      <!-- Reviews injected here -->
                  </div>
              </div>
           </div>

           <!-- COMPLIANCE MODULE -->
           <div id="sec-compliance" class="report-section mt-8 pt-8 border-t border-brand-border">
              <div class="flex justify-between items-center mb-4">
                 <h3 class="text-zinc-500 font-bold text-xs uppercase tracking-widest flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path></svg>
                    Compliance & Regulation
                 </h3>
                 <button class="enhance-btn text-xs" data-section="compliance">Check</button>
              </div>
              <div class="bg-white border border-brand-border rounded-xl shadow-sm p-6">
                  <ul class="space-y-4 text-sm">
                    <li class="flex justify-between items-center">
                       <span class="text-zinc-600 font-medium">OFAC / SDN List</span>
                       <span id="reg-ofac" class="text-[10px] font-bold px-2 py-1 rounded bg-zinc-100 text-zinc-500">--</span>
                    </li>
                    <li class="flex justify-between items-center">
                       <span class="text-zinc-600 font-medium">Gov Contracts (SAM)</span>
                       <span id="reg-gov" class="text-[10px] font-bold px-2 py-1 rounded bg-zinc-100 text-zinc-500">--</span>
                    </li>
                  </ul>
              </div>
           </div>

           <!-- SOURCES FOOTER -->
           <div id="sec-sources" class="report-section mt-8 pt-8 border-t border-brand-border">
              <h3 class="text-zinc-500 font-bold text-sm uppercase tracking-widest mb-4 flex items-center gap-2">
                 <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path></svg>
                 Evidence Locker (Sources)
              </h3>
              <div id="source-links" class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4"></div>
           </div>

        </div>

      </div>
      
      <!-- QA -->
      <div id="sec-qa" class="mt-8 bg-white border border-brand-border rounded-2xl p-8 text-brand-dark shadow-card">
         <h3 class="text-xl font-bold mb-4">Forensic Assistant</h3>
         <div class="relative">
            <input type="text" id="qa-input" class="w-full bg-zinc-50 border border-zinc-200 rounded-lg px-4 py-3 pr-24 text-sm focus:border-brand-primary transition-colors placeholder-zinc-400 text-brand-dark" placeholder="E.g., Based on the reviews, what is the primary customer complaint?" />
            <button id="qa-btn" class="absolute right-1.5 top-1.5 bg-brand-primary text-white text-xs font-bold px-4 py-2 rounded hover:opacity-90">Ask AI</button>
         </div>
         <div id="qa-response" class="mt-4 text-sm text-zinc-600 leading-relaxed hidden p-4 bg-zinc-50 rounded border border-zinc-200"></div>
      </div>

    </div>
  </main>

  <!-- MODAL: API KEY -->
  <div id="api-modal" class="fixed inset-0 z-[60] bg-black/60 backdrop-blur-sm hidden flex items-center justify-center p-4">
     <div class="bg-white rounded-xl p-6 w-full max-w-md shadow-2xl transform transition-all scale-100">
        <div class="flex justify-between items-center mb-4">
           <h3 class="font-bold text-lg">Configure Intelligence Feed</h3>
           <button id="close-api-btn" class="text-zinc-400 hover:text-zinc-900">&times;</button>
        </div>
        
        <p class="text-sm text-zinc-500 mb-4">Enter your Google Gemini API Key to enable live scraping and forensic analysis.</p>
        
        <div class="space-y-4 mb-6">
            <div>
                <label class="block text-xs font-bold text-zinc-500 uppercase mb-1.5">API Key</label>
                <input id="api-key-input" type="password" class="w-full border border-zinc-300 rounded-lg px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-black" placeholder="AIza..." />
            </div>
            
            <div>
                <label class="block text-xs font-bold text-zinc-500 uppercase mb-1.5">Reasoning Model</label>
                <div class="relative">
                    <select id="model-select" class="w-full appearance-none border border-zinc-300 rounded-lg px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-black bg-white">
                        <option value="gemini-2.5-flash-preview-09-2025">Gemini 2.5 Flash (Recommended)</option>
                        <option value="gemini-2.5-pro-preview-09-2025">Gemini 2.5 Pro (Complex Reasoning)</option>
                        <option value="gemini-3.0-pro-exp">Gemini 3.0 Pro (Experimental)</option>
                        <option value="gemini-2.0-flash-exp">Gemini 2.0 Flash Experimental</option>
                        <option value="gemini-1.5-flash">Gemini 1.5 Flash</option>
                        <option value="gemini-1.5-pro">Gemini 1.5 Pro (Legacy)</option>
                    </select>
                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-zinc-500">
                        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </div>
                </div>
            </div>
        </div>

        <div class="flex justify-end gap-3">
           <button id="clear-key" class="text-red-600 text-xs font-bold hover:bg-red-50 px-3 py-2 rounded">Clear</button>
           <button id="save-key" class="bg-black text-white text-xs font-bold px-6 py-2 rounded hover:opacity-80">Save Credentials</button>
        </div>
     </div>
  </div>

  <script>
    // --- CORE UTILS ---
    const $ = id => document.getElementById(id);
    
    const makeLink = (text, url, cls = 'font-bold text-brand-dark hover:underline') => {
        if (url && url.startsWith('http') && text && text !== '--') {
            return `<a href="${url}" target="_blank" class="${cls} decoration-zinc-400 inline-flex items-center gap-1" title="Verified Source">${text} <svg class="w-3 h-3 opacity-40" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg></a>`;
        }
        return `<span class="${cls}">${text || '--'}</span>`;
    };

    const showError = msg => {
       $('error-message').innerText = msg;
       $('error-toast').classList.add('show');
       setTimeout(() => $('error-toast').classList.remove('show'), 5000);
    };

    // --- STATE ---
    let lastReportData = null;

    // --- MAIN APP LOGIC ---
    document.addEventListener('DOMContentLoaded', () => {
        
        // Settings Logic
        $('settings-btn').onclick = () => { 
            $('api-key-input').value = localStorage.getItem('tb_api_key') || ''; 
            $('model-select').value = localStorage.getItem('tb_model') || 'gemini-2.5-flash-preview-09-2025';
            $('api-modal').classList.remove('hidden'); 
        };
        
        $('close-api-btn').onclick = () => $('api-modal').classList.add('hidden');
        
        $('save-key').onclick = () => { 
            if($('api-key-input').value) localStorage.setItem('tb_api_key', $('api-key-input').value.trim());
            localStorage.setItem('tb_model', $('model-select').value);
            $('api-modal').classList.add('hidden');
        };
        
        $('clear-key').onclick = () => { 
            localStorage.removeItem('tb_api_key'); 
            localStorage.removeItem('tb_model');
            $('api-key-input').value = ''; 
        };

        const getApiKey = () => localStorage.getItem('tb_api_key');
        const getModel = () => localStorage.getItem('tb_model') || 'gemini-2.5-flash-preview-09-2025';

        // Nav Spy Logic
        const sections = document.querySelectorAll('.report-section');
        const pills = document.querySelectorAll('.nav-pill');
        const onScroll = () => {
            let current = '';
            const offset = ($('main-header').offsetHeight) + 40;
            sections.forEach(section => {
                if (window.scrollY + offset >= section.offsetTop) current = section.getAttribute('id');
            });
            pills.forEach(pill => {
                pill.classList.toggle('active', pill.getAttribute('data-nav') === current);
            });
        };
        const observer = new IntersectionObserver(entries => {
            if(entries[0].isIntersecting) { window.addEventListener('scroll', onScroll); onScroll(); }
            else window.removeEventListener('scroll', onScroll);
        }, { threshold: 0.05 });
        observer.observe($('report-view'));

        // --- SEARCH LOGIC ---
        window.runSearch = (term) => { $('search-input').value = term; $('generate-btn').click(); };
        
        // Enter Key Listener for Search
        $('search-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') $('generate-btn').click();
        });

        $('generate-btn').onclick = async () => {
            const name = $('search-input').value.trim();
            if(!name) return;
            runAudit(name, false);
        };

        $('reverify-btn').onclick = () => runAudit($('h-name').innerText, true);

        document.querySelectorAll('.enhance-btn').forEach(btn => {
            btn.onclick = function(e) {
                if(this.id === 'reverify-btn') return;
                const section = this.dataset.section;
                runAudit($('h-name').innerText, true, section, this);
                e.stopPropagation(); // Stop header click overlap
            };
        });

        // --- AUDIT FUNCTION ---
        async function runAudit(name, isEnhanced, focusSection = null, btnEl = null) {
            const apiKey = getApiKey();
            if(!apiKey) { $('settings-btn').click(); return; }
            
            const modelId = getModel();

            // UI TRANSITION
            let originalBtnHtml = '';
            let loaderInterval;

            if(btnEl) { 
                originalBtnHtml = btnEl.innerHTML; 
                btnEl.innerHTML = `<svg class="animate-spin h-3 w-3 inline" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>`; 
                btnEl.disabled = true; 
            }
            
            let overlay;
            if(focusSection) {
                const el = $(`sec-${focusSection}`);
                overlay = document.createElement('div'); overlay.className = 'section-loading';
                overlay.innerHTML = `<span class="text-xs font-bold animate-pulse">UPDATING DATABANKS...</span>`;
                el.appendChild(overlay);
            } else {
                $('search-view').classList.add('hidden');
                $('report-view').classList.add('hidden');
                $('loader-view').classList.remove('hidden');

                // Start professional text cycle
                const steps = [
                    "Authenticating with global registries...",
                    "Querying federal & state databases...",
                    "Aggregating regulatory filings...",
                    "Cross-referencing litigation records...",
                    "Analyzing sentiment & reputation...",
                    "Finalizing forensic dossier..."
                ];
                let stepIdx = 0;
                loaderInterval = setInterval(() => {
                    $('loader-step').innerText = steps[stepIdx];
                    stepIdx = (stepIdx + 1) % steps.length;
                }, 1200);
            }

            // PROMPT GENERATION
            let promptTask = isEnhanced 
                ? `ROLE: Lead Forensic Auditor. TASK: Deep dive update for entity "${name}".` 
                : `ROLE: Elite Corporate Investigator. TASK: Generate Full Forensic Dossier for "${name}".`;
            
            let specificInstr = `
                GLOBAL REQUIREMENT: Populate all JSON fields. Use real world data found via search tools.
                CRITICAL INSTRUCTION: For the "reviews" array, you MUST find and summarize AT LEAST 6 distinct reviews from different sources (Reddit, Glassdoor, Trustpilot, Google Maps, BBB, Yelp, Industry Forums). Look for sentiment, specific complaints, or praise.
                REQUIRED JSON SCHEMA (Output ONLY Valid JSON). Output PURE JSON. No intro. No markdown.
            `;
            
            if(focusSection) {
                specificInstr += ` FOCUS ONLY on updating the "${focusSection}" key in the JSON with deep data. Preserve other data.`;
            }

            const systemPrompt = `
                ${promptTask}
                ${specificInstr}
                PREVIOUS DATA: ${isEnhanced ? JSON.stringify(lastReportData) : '{}'}

                REQUIRED JSON SCHEMA (Output ONLY Valid JSON):
                {
                    "meta": { "memo": "Forensic summary (3 sentences).", "trustScore": 0-1000 (integer), "status": "Active/Inactive/Warning" },
                    "info": { "name": "string", "location": "string", "website": "string", "phone": "string" },
                    "sos": { "name": "Legal Name", "id": "File ID", "date": "YYYY-MM-DD", "state": "string", "agent": "string", "url": "string" },
                    "leadership": { "executives": [{"name": "string", "role": "string", "notes": "background notes", "url": "linkedin/bio url"}] },
                    "digital": { "domain": "string", "age": "string", "tech": ["string"], "url": "string" },
                    "litigation": [{"type": "string", "case_id": "string", "parties": "string", "date": "string", "status": "string", "url": "string"}],
                    "reputation": { 
                        "bbb": { "grade": "string", "accredited": "Yes/No", "complaints": "string", "summary": "string", "url": "string" },
                        "reviews": [{"source": "string", "rating": "string", "text": "string (summary of review)", "url": "string"}] 
                    },
                    "compliance": { "ofac": "Clean/Hit", "govContracts": "Yes/No" },
                    "sources": [{"title": "string", "url": "string"}]
                }
            `;

            try {
                // Using standard model to ensure availability
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${modelId}:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ role: "user", parts: [{ text: systemPrompt }] }],
                        tools: [{ google_search: {} }], // Enable grounding
                        // generationConfig: { responseMimeType: "application/json" } // REMOVED to fix conflict with tools
                    })
                });
                
                if(!response.ok) {
                    const errText = await response.text();
                    throw new Error(`API Error ${response.status}: ${errText || 'Check API Key'}`);
                }
                
                const data = await response.json();
                let jsonRaw = data.candidates[0].content.parts[0].text;

                // Robust JSON extraction
                const startIndex = jsonRaw.indexOf('{');
                const endIndex = jsonRaw.lastIndexOf('}');
                
                if (startIndex === -1 || endIndex === -1) {
                    throw new Error("AI response format invalid (no JSON found). Please try again.");
                }
                
                jsonRaw = jsonRaw.substring(startIndex, endIndex + 1);

                const resultData = JSON.parse(jsonRaw);

                // Fallback source links if Google grounding metadata exists
                if(data.candidates[0].groundingMetadata?.webSearchQueries) {
                   const queries = data.candidates[0].groundingMetadata.webSearchQueries;
                   if((!resultData.sources || resultData.sources.length === 0)) {
                       resultData.sources = queries.map(q => ({ title: q, url: `https://google.com/search?q=${encodeURIComponent(q)}`}));
                   }
                }

                renderReport(resultData);

            } catch(e) {
                console.error(e);
                showError(e.message);
                $('search-view').classList.remove('hidden');
                $('loader-view').classList.add('hidden');
            } finally {
                if(loaderInterval) clearInterval(loaderInterval);
                if(btnEl) { btnEl.innerHTML = originalBtnHtml; btnEl.disabled = false; }
                if(overlay) overlay.remove();
            }
        }

        // --- RENDER FUNCTION ---
        function renderReport(data) {
            lastReportData = data; // Update state
            
            // Transitions
            $('loader-view').classList.add('hidden');
            $('report-view').classList.remove('hidden');
            $('search-view').classList.add('hidden');

            // Helper for simple text
            const txt = (id, val) => { 
                const el = $(id); 
                if(!el) return;
                if(!val || val === 'null' || val === 'undefined') {
                    el.innerText = '--';
                    el.classList.add('empty-value');
                } else {
                    el.innerText = val;
                    el.classList.remove('empty-value');
                }
            };

            // Helper for HTML or Formatted Text
            const html = (id, val) => { 
                const el = $(id);
                if(el) el.innerHTML = val || '--'; 
            };

            // Markdown Cleaner for Summaries
            const cleanMd = (text) => {
                if(!text) return '--';
                // Convert **bold** to <b>bold</b>
                let clean = text.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>');
                // Convert *italic* to <i>italic</i>
                clean = clean.replace(/\*(.*?)\*/g, '<i>$1</i>');
                return clean;
            };

            // HEADER
            txt('h-name', data.info.name);
            txt('h-loc', data.info.location);
            const linkEl = $('h-web'); 
            linkEl.href = data.info.website || '#'; 
            
            // SAFE URL PARSING
            try {
                linkEl.innerText = data.info.website ? new URL(data.info.website).hostname : '--';
            } catch(e) {
                linkEl.innerText = data.info.website || '--';
            }
            
            // Use cleaner for memo
            html('h-memo', cleanMd(data.meta.memo));
            
            // STATUS BADGE
            const status = (data.meta.status || '').toLowerCase();
            const sBadge = $('sos-badge');
            sBadge.innerText = data.meta.status || 'Unknown';
            sBadge.className = `text-xs font-bold px-3 py-1 rounded-full border uppercase tracking-wide ${status.includes('active') ? 'bg-emerald-50 text-emerald-700 border-emerald-200' : 'bg-red-50 text-red-700 border-red-200'}`;

            // GAUGE
            txt('g-score', data.meta.trustScore);
            const score = data.meta.trustScore || 0;
            const circle = $('g-circle-progress');
            const circumference = 283;
            const offset = 283 - ((score / 1000) * 283);
            circle.style.strokeDashoffset = offset;
            // Color logic
            circle.style.stroke = score > 700 ? '#10b981' : score > 500 ? '#f59e0b' : '#ef4444';
            $('g-badge').innerText = score > 700 ? 'Low Risk' : score > 500 ? 'Med Risk' : 'High Risk';

            // SOS
            html('c-name', makeLink(data.sos.name, data.sos.url));
            txt('c-id', data.sos.id);
            txt('c-state', data.sos.state);
            txt('c-date', data.sos.date);
            txt('c-agent', data.sos.agent);

            if(data.sos.date) {
                $('h-founded-container').classList.remove('hidden');
                $('h-founded').innerText = data.sos.date.substring(0, 4);
            }

            // LEADERSHIP (Card Grid)
            const leadList = $('leadership-list');
            leadList.innerHTML = '';
            if(data.leadership?.executives?.length) {
                data.leadership.executives.forEach(exec => {
                    leadList.innerHTML += `
                    <div class="p-3 border border-zinc-200 rounded-lg hover:bg-zinc-50 transition-colors">
                        <div class="font-bold text-brand-dark">${makeLink(exec.name, exec.url, 'hover:underline')}</div>
                        <div class="text-xs text-zinc-500 font-bold uppercase mb-1">${exec.role || 'Principal'}</div>
                        ${exec.notes ? `<p class="text-xs text-zinc-600 leading-tight mt-1 line-clamp-2">"${exec.notes}"</p>` : ''}
                    </div>`;
                });
            } else { leadList.innerHTML = '<span class="text-zinc-400 italic text-sm col-span-2">No public leadership records located.</span>'; }

            // FINANCIALS REMOVED

            // LITIGATION
            const legalRows = $('legal-rows');
            legalRows.innerHTML = '';
            if(data.litigation && data.litigation.length) {
                $('legal-empty').classList.add('hidden');
                data.litigation.forEach(row => {
                    legalRows.innerHTML += `
                    <tr>
                        <td><span class="bg-zinc-100 text-zinc-600 text-[10px] px-2 py-1 rounded font-bold uppercase border border-zinc-200">${row.type}</span></td>
                        <td class="font-mono text-xs">${makeLink(row.case_id, row.url, 'text-blue-600 hover:underline')}</td>
                        <td class="text-xs font-medium text-zinc-700 truncate max-w-[200px]">${row.parties}</td>
                        <td class="text-xs text-zinc-500">${row.date}</td>
                        <td class="text-xs font-bold text-zinc-500">${row.status}</td>
                    </tr>`;
                });
            } else { $('legal-empty').classList.remove('hidden'); }

            // REPUTATION
            const bbb = data.reputation?.bbb || {};
            html('bbb-grade', makeLink(bbb.grade, bbb.url, 'hover:underline text-brand-primary'));
            txt('bbb-status', bbb.accredited);
            txt('bbb-complaints', bbb.complaints);
            
            // Use cleaner for summary
            html('bbb-summary', cleanMd(bbb.summary));

            // REVIEWS (Logic for 6 items formatting)
            const revList = $('reviews-list');
            revList.innerHTML = '';
            const reviews = data.reputation?.reviews || [];
            if(reviews.length) {
                reviews.forEach(rev => {
                    // Sentiment coloring check
                    let badgeColor = 'bg-zinc-200 text-zinc-600';
                    const rText = (rev.rating || '').toLowerCase();
                    if(rText.includes('5') || rText.includes('pos') || rText.includes('exc')) badgeColor = 'bg-emerald-100 text-emerald-800';
                    else if(rText.includes('1') || rText.includes('neg') || rText.includes('bad')) badgeColor = 'bg-red-100 text-red-800';

                    revList.innerHTML += `
                    <div class="p-5 hover:bg-zinc-50 transition-colors">
                       <div class="flex justify-between items-start mb-2">
                          <div class="flex items-center gap-2">
                             ${makeLink(rev.source, rev.url, 'font-bold text-sm text-brand-dark')}
                             <span class="text-[10px] font-bold uppercase px-2 py-0.5 rounded ${badgeColor}">${rev.rating}</span>
                          </div>
                          <svg class="w-3 h-3 text-zinc-300" fill="currentColor" viewBox="0 0 24 24"><path d="M14.017 21L14.017 18C14.017 16.8954 13.1216 16 12.017 16H9.01703C7.91246 16 7.01703 16.8954 7.01703 18V21H14.017ZM21.017 21L21.017 18C21.017 16.8954 20.1216 16 19.017 16H16.017C14.9125 16 14.017 16.8954 14.017 18V21H21.017ZM7.01703 14C6.46475 14 6.01703 14.4477 6.01703 15L6.01703 21L2.01703 21L2.01703 15C2.01703 11.3275 3.12084 7.85676 5.15188 5H19.017C19.6535 5 20.227 5.26432 20.6306 5.68567C20.8247 5.40087 20.983 5.1073 21.1025 4.80724C21.4797 3.86126 20.9863 2.78502 20.0035 2.57822C15.9551 1.72649 11.023 2.13011 8.03456 4.3561C4.5463 6.95494 3.1785 10.7043 3.02597 14.3983C3.02023 14.5375 3.01703 14.6786 3.01703 14.8223V22H5.01703V15C5.01703 14.4477 5.46475 14 6.01703 14H7.01703ZM7.01703 7C6.46475 7 6.01703 7.44772 6.01703 8C6.01703 8.55228 6.46475 9 7.01703 9H19.017C19.5693 9 20.017 8.55228 20.017 8C20.017 7.44772 19.5693 7 19.017 7H7.01703Z"></path></svg>
                       </div>
                       <p class="text-sm text-zinc-600 leading-relaxed line-clamp-3">${rev.text}</p>
                    </div>
                    `;
                });
            } else {
                revList.innerHTML = `<div class="p-8 text-center text-sm text-zinc-400">No detailed consumer reviews found.</div>`;
            }

            // DIGITAL
            txt('d-domain', data.digital?.domain);
            txt('d-age', data.digital?.age);
            const techList = $('d-tech'); techList.innerHTML = '';
            (data.digital?.tech || []).forEach(t => {
                techList.innerHTML += `<span class="text-[10px] bg-zinc-100 border border-zinc-200 px-2 py-1 rounded text-zinc-600 font-medium uppercase">${t}</span>`;
            });

            // COMPLIANCE
            txt('reg-ofac', data.compliance?.ofac);
            txt('reg-gov', data.compliance?.govContracts);

            // SOURCES
            const srcBox = $('source-links'); srcBox.innerHTML = '';
            (data.sources || []).forEach(src => {
               if(src.url && src.url.startsWith('http')) {
                  let host = 'External Source';
                  try {
                      host = new URL(src.url).hostname;
                  } catch(e) {
                      // Fail silently, keep default
                  }
                  
                  srcBox.innerHTML += `<a href="${src.url}" target="_blank" class="block p-4 bg-zinc-50 rounded border border-zinc-200 hover:border-brand-primary hover:bg-white hover:shadow-sm transition-all">
                    <div class="text-xs font-bold text-zinc-400 uppercase mb-1 truncate">${host}</div>
                    <div class="text-sm font-medium text-brand-dark truncate">${src.title}</div>
                  </a>`;
               }
            });
        }

        // QA Handler
        $('qa-btn').onclick = async () => {
            const q = $('qa-input').value;
            const apiKey = getApiKey();
            if(!q || !lastReportData || !apiKey) return;
            
            const modelId = getModel();
            const out = $('qa-response');
            out.classList.remove('hidden');
            out.innerText = "Forensic Analysis running...";
            
            try {
                const resp = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${modelId}:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ role: "user", parts: [{ text: `CONTEXT JSON: ${JSON.stringify(lastReportData)} \n USER QUESTION: ${q} \n Provide a brief, objective answer.` }] }]
                    })
                });
                const json = await resp.json();
                out.innerText = json.candidates[0].content.parts[0].text;
            } catch(e) { out.innerText = "Analysis failed."; }
        };

    });
  </script>
</body>
</html>
